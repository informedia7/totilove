<!-- Include Universal Message Modal -->
{{include:modals/universal-message-modal}}

<!-- Include User Profile Modal -->
{{include:modals/user-profile-modal}}

<!-- Include User Report Modal -->
{{include:modals/user-report-modal}}

<!-- Search Header with Quick Stats -->
<div class="search-header">
    <div class="search-title">
        <h2><i class="fas fa-search"></i> Smart Matching System</h2>
        <p class="search-subtitle">Find your perfect match with our advanced search filters</p>
    </div>
    <div class="search-stats">
        <div class="stat-card">
            <i class="fas fa-users"></i>
            <div class="stat-content">
                <span class="stat-number" id="total-users">1,247</span>
                <span class="stat-label">Active Users</span>
            </div>
        </div>
        <div class="stat-card">
            <i class="fas fa-heart"></i>
            <div class="stat-content">
                <span class="stat-number" id="matches-today">0</span>
                <span class="stat-label">Matches Today</span>
            </div>
        </div>
        <div class="stat-card">
            <i class="fas fa-heart"></i>
            <div class="stat-content">
                <span class="stat-number" id="total-matches">0</span>
                <span class="stat-label">Total Matches</span>
            </div>
        </div>
        <div class="stat-card">
            <i class="fas fa-circle"></i>
            <div class="stat-content">
                <span class="stat-number" id="online-matches">0</span>
                <span class="stat-label">Online Now</span>
            </div>
        </div>
    </div>
</div>

<div class="matches-section">
    <div class="matches-header">
        <div class="header-left">
            <h3>
                <i class="fas fa-heart" style="color: #e74c3c;"></i>
                Your Matches
                <span class="matches-count" id="matches-count">(0)</span>
            </h3>
            <div class="matches-info">
                <p>Your potential matches based on compatibility</p>
            </div>
        </div>
        <div class="header-right">
            <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                <div class="view-controls" style="display: flex; align-items: center; gap: 0.5rem;">
                    <label for="cardsPerRow" style="font-size: 0.9rem; color: var(--dark-color); font-weight: 500; white-space: nowrap;">Cards per row:</label>
                    <select id="cardsPerRow" name="cardsPerRow" style="padding: 0.5rem 0.75rem; border: 1px solid #ddd; border-radius: 8px; background: white; font-size: 0.9rem; cursor: pointer; transition: border-color 0.3s ease;">
                        <option value="3">3</option>
                        <option value="4" selected>4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                    </select>
                </div>
                <div class="view-toggle">
                    <button class="view-btn active" data-view="grid" title="Grid View">
                        <i class="fas fa-th"></i>
                    </button>
                    <button class="view-btn" data-view="list" title="List View">
                        <i class="fas fa-list"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters and Search -->
    <div class="matches-filters">
        <div class="filter-group">
            <label for="search-matches">
                <i class="fas fa-search"></i>
            </label>
            <input type="text" id="search-matches" placeholder="Search by location...">
        </div>
        <div class="filter-group">
            <label for="sort-matches">Sort by:</label>
            <select id="sort-matches">
                <option value="compatibility" selected>Highest Match</option>
                <option value="recent">Most Recent</option>
                <option value="oldest">Oldest First</option>
                <option value="age-asc">Age (Youngest)</option>
                <option value="age-desc">Age (Oldest)</option>
                <option value="online">Online First</option>
            </select>
        </div>
        <div class="filter-group">
            <label>
                <input type="checkbox" id="filter-online-only">
                Show only online
            </label>
        </div>
        <div class="filter-group">
            <label>
                <input type="checkbox" id="filter-with-photos">
                With photos only
            </label>
        </div>
        <div class="filter-group match-score-filter">
            <label for="match-score-slider" style="margin-right: 0.5rem;">Match score:</label>
            <div class="match-score-slider-container">
                <input type="range" 
                       class="match-score-slider" 
                       id="match-score-slider" 
                       min="1" 
                       max="100" 
                       value="1"
                       step="1">
                <div class="match-score-display">
                    <span class="match-score-value" id="match-score-value">1%+ (All)</span>
                    <button type="button" class="match-score-reset-btn" id="match-score-reset" title="Reset to all matches">Ã—</button>
                </div>
            </div>
        </div>
        <button class="filter-reset-btn" id="reset-filters">
            <i class="fas fa-redo"></i> Reset
        </button>
    </div>

    <!-- Bulk Actions (hidden by default) -->
    <div class="bulk-actions" id="bulk-actions" style="display: none;">
        <span class="selected-count" id="selected-count">0 selected</span>
        <button class="bulk-btn" onclick="bulkMessage()">
            <i class="fas fa-envelope"></i> Message All
        </button>
        <button class="bulk-btn" onclick="bulkFavorite()">
            <i class="fas fa-star"></i> Add to Favorites
        </button>
        <button class="bulk-btn danger" onclick="bulkUnmatch()">
            <i class="fas fa-times"></i> Unmatch
        </button>
    </div>


    <!-- Matches Grid/List Container -->
    <div class="online-users-grid" id="matches-users">
        <!-- Matches will be populated here -->
    </div>

    <!-- Pagination -->
    <div class="pagination" id="pagination" style="display: none;">
        <button class="page-btn" id="prev-page" disabled>
            <i class="fas fa-chevron-left"></i> Previous
        </button>
        <span class="page-info" id="page-info">Page 1 of 1</span>
        <button class="page-btn" id="next-page">
            Next <i class="fas fa-chevron-right"></i>
        </button>
    </div>

    <!-- Load More Button (Alternative to pagination) -->
    <div class="load-more-container" id="load-more-container" style="display: none;">
        <button class="load-more-btn" id="load-more-btn">
            <i class="fas fa-arrow-down"></i> Load More Matches
        </button>
    </div>
</div>

<script>
// Global state
let allMatches = [];
let filteredMatches = [];
let currentView = 'grid';
let currentPage = 1;
let itemsPerPage = 12;
let sortBy = 'compatibility';

let filters = {
    search: '',
    onlineOnly: false,
    withPhotos: false,
    minCompatibilityScore: null
};

// Load stats
async function loadStats() {
    try {
        const sessionToken = getSessionToken();
        if (!sessionToken) return;

        // Load total users
        const totalUsersRes = await fetch(`/api/stats/total-users?token=${sessionToken}`);
        const totalUsersData = await totalUsersRes.json();
        if (totalUsersData.success) {
            document.getElementById('total-users').textContent = totalUsersData.count.toLocaleString();
        }

        // Matches today will be updated dynamically from updateMatchStats function

    } catch (error) {
        console.error('Error loading stats:', error);
    }
}

// Load matches
async function loadMatches() {
    const container = document.getElementById('matches-users');
    // No loading spinner - show empty state immediately
    container.innerHTML = '';

    try {
        const userId = getUserId();
        const sessionToken = getSessionToken();
        
        if (!userId) {
            throw new Error('User not authenticated');
        }

        const response = await fetch(`/api/matches/${userId}?token=${sessionToken}`, {
            headers: {
                'Authorization': `Bearer ${sessionToken}`,
                'X-Session-Token': sessionToken
            }
        });
        
        const data = await response.json();

        if (data.success && data.matches && data.matches.length > 0) {
            allMatches = data.matches;
            updateMatchStats(data.matches);
            
            // Load saved match score preference from database response
            // The backend returns minCompatibilityScore (number 1-100, or null for default/all)
            filters.minCompatibilityScore = (data.minCompatibilityScore !== undefined && data.minCompatibilityScore !== null && data.minCompatibilityScore !== '') 
                ? parseInt(data.minCompatibilityScore) 
                : 1; // Default to 1% (show all matches >= 1%)
            
            // Update slider state
            const matchScoreSlider = document.getElementById('match-score-slider');
            const matchScoreValue = document.getElementById('match-score-value');
            if (matchScoreSlider && matchScoreValue) {
                const value = filters.minCompatibilityScore || 1;
                matchScoreSlider.value = value;
                matchScoreValue.textContent = value === 1 ? '1%+ (All)' : `${value}%+`;
            }
            
            applyFiltersAndSort();
        } else {
            allMatches = [];
            filteredMatches = [];
            document.getElementById('matches-count').textContent = '(0)';
            showEmptyState();
        }
    } catch (error) {
        console.error('Error loading matches:', error);
        container.innerHTML = `
            <div class="error-state">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Failed to load matches</h3>
                <p>Please try again later</p>
                <button class="btn-primary" onclick="loadMatches()">
                    <i class="fas fa-redo"></i> Retry
                </button>
            </div>
        `;
        document.getElementById('matches-count').textContent = '(0)';
    }
}

// Update match statistics
function updateMatchStats(matches) {
    const total = matches.length;
    const online = matches.filter(m => m.is_online).length;
    const newToday = matches.filter(m => {
        if (!m.match_date) return false;
        
        try {
            const matchDate = new Date(m.match_date);
            const today = new Date();
            
            // Reset time to midnight for both dates to compare only dates
            const matchDateOnly = new Date(matchDate.getFullYear(), matchDate.getMonth(), matchDate.getDate());
            const todayOnly = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            
            // Compare timestamps (should be 0 if same date)
            return matchDateOnly.getTime() === todayOnly.getTime();
        } catch (e) {
            console.error('Error parsing match_date:', m.match_date, e);
            return false;
        }
    }).length;

    // Update matches count in header
    const matchesCountEl = document.getElementById('matches-count');
    if (matchesCountEl) {
        matchesCountEl.textContent = `(${total})`;
    }
    
    // Update match statistics in header
    const totalMatchesEl = document.getElementById('total-matches');
    const onlineMatchesEl = document.getElementById('online-matches');
    const matchesTodayEl = document.getElementById('matches-today');
    
    if (totalMatchesEl) totalMatchesEl.textContent = total;
    if (onlineMatchesEl) onlineMatchesEl.textContent = online;
    // Make "Matches Today" dynamic - use the newToday value
    if (matchesTodayEl) matchesTodayEl.textContent = newToday;
}

// Format match date
function formatMatchDate(matchDate) {
    if (!matchDate) return 'Recently';
    
    const now = new Date();
    const match = new Date(matchDate);
    const diffMs = now - match;
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays = Math.floor(diffMs / 86400000);

    if (diffMins < 1) return 'Just now';
    if (diffMins < 60) return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;
    if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
    if (diffDays === 1) return 'Yesterday';
    if (diffDays < 7) return `${diffDays} days ago`;
    return match.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
}

// Check if match is new (last 24 hours)
function isNewMatch(matchDate) {
    if (!matchDate) return false;
    const match = new Date(matchDate);
    const now = new Date();
    const diffHours = (now - match) / (1000 * 60 * 60);
    return diffHours < 24;
}

// Render match card
function renderMatchCard(user, view = 'grid') {
    const real_name = user.real_name || user.name || 'Unknown';
    const age = user.age || calculateAge(user.birthdate) || '?';
    const location = user.location || user.city || 'Unknown location';
    const userId = user.id || user.user_id || user.userId;
    const gender = user.gender || '';
    
    // Get default image based on gender
    const getDefaultImage = (gender) => {
        if (!gender) return '/assets/images/default_profile_male.svg';
        const genderLower = gender.toString().toLowerCase();
        if (genderLower === 'f' || genderLower === 'female') {
            return '/assets/images/default_profile_female.svg';
        } else if (genderLower === 'm' || genderLower === 'male') {
            return '/assets/images/default_profile_male.svg';
        }
        return '/assets/images/default_profile_male.svg';
    };
    
    const defaultImage = getDefaultImage(gender);
    // Handle null/undefined from backend (backend returns null for defaults)
    // Also handle string "null" which can come from JSON serialization
    const avatar = (user.profile_image && 
                    user.profile_image !== 'null' && 
                    user.profile_image !== null && 
                    !user.profile_image.includes('default_profile.svg')) 
                    ? user.profile_image 
                    : ((user.avatar && 
                        user.avatar !== 'null' && 
                        user.avatar !== null && 
                        !user.avatar.includes('default_profile.svg')) 
                        ? user.avatar 
                        : null);
    const isNew = isNewMatch(user.match_date);
    const isOnline = user.is_online || false;
    const compatibility = user.compatibility_score || 70; // Use API score, fallback to 70
    const compatibilityBadgeData = user.compatibility_badge || null;
    
    // Don't prepend /uploads/ if it's already a full path or a default image
    let profileImage = defaultImage;
    if (avatar && avatar !== defaultImage && avatar !== 'null') {
        // If it's a default image, use gender-specific default
        if (avatar.includes('default_profile.svg')) {
            profileImage = defaultImage;
        } else if (avatar.startsWith('/uploads/profile_images/')) {
            // Already a full upload path, use as is
            profileImage = avatar;
        } else if (avatar.startsWith('/assets/images/')) {
            // Other assets images (like gender-specific defaults), use as is
            profileImage = avatar;
        } else if (!avatar.includes('/') && !avatar.includes('default_profile')) {
            // Only prepend if it's a filename (not a path) and not a default image
            profileImage = `/uploads/profile_images/${avatar}`;
        } else {
            // Default fallback
            profileImage = defaultImage;
        }
    }
    
    const genderLower = (gender || '').toLowerCase().trim();
    const genderIcon = (genderLower === 'male' || genderLower === 'm') ? 'fa-mars' : (genderLower === 'female' || genderLower === 'f') ? 'fa-venus' : '';
    const genderClass = (genderLower === 'male' || genderLower === 'm') ? 'male' : (genderLower === 'female' || genderLower === 'f') ? 'female' : '';
    const genderIconHtml = genderIcon ? `<i class="fas ${genderIcon} gender-icon ${genderClass}"></i>` : '';
    const ageBadgeHtml = age ? `<span class="age-badge">${age}</span>` : '';
    
    const newBadge = isNew ? '<span class="new-match-badge"><i class="fas fa-star"></i> New</span>' : '';
    
    // Compatibility badge - show only percentage and "Match" (no label)
    let compatibilityBadge = '';
    if (compatibilityBadgeData && compatibilityBadgeData.label) {
        // Use badge color but only show percentage and "Match"
        compatibilityBadge = `<div class="compatibility-badge" style="background: ${compatibilityBadgeData.color || 'rgba(102, 126, 234, 0.9)'};" title="${compatibilityBadgeData.label}">
            ${compatibility}% Match
        </div>`;
    } else {
        compatibilityBadge = `<div class="compatibility-badge">${compatibility}% Match</div>`;
    }
    const onlineDot = isOnline ? '<div style="position: absolute; top: 0.5rem; right: 0.5rem; width: 16px; height: 16px; background: #00b894; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.2); z-index: 10;"></div>' : '';
    
    const interestsHtml = user.interests && Array.isArray(user.interests) && user.interests.length > 0 
        ? `<div class="user-interests" style="margin-bottom: 0.5rem; display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: center;">
            ${user.interests.slice(0, 3).map(interest => {
                const interestName = interest.name || interest;
                return `<span style="display: inline-flex; align-items: center; gap: 0.3rem; padding: 0.2rem 0.5rem; background: #f5f6fa; border-radius: 8px; font-size: 0.8rem; color: #636e72;"><i class="fas fa-star"></i>${interestName}</span>`;
            }).join('')}
        </div>` : '';
    
    const aboutHtml = user.about ? `<p class="user-about" style="font-size: 0.9rem; color: #636e72; margin-bottom: 1rem; display: -webkit-box; -webkit-line-clamp: 3; line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 4.5em; line-height: 1.4;">${user.about}</p>` : '';
    
    // Grid view layout
    if (view === 'grid') {
        return `
        <div class="online-user-card" data-user-id="${userId}" onclick="viewProfile(${userId})" style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(31,38,135,0.08); transition: transform 0.2s; cursor: pointer; position: relative;">
            <div class="match-card-checkbox" style="position: absolute; top: 0.5rem; left: 0.5rem; z-index: 10;">
                <label for="match-select-${userId}" style="cursor: pointer; display: block;">
                    <input type="checkbox" class="match-select" id="match-select-${userId}" data-user-id="${userId}" onclick="event.stopPropagation(); toggleSelection(${userId})" aria-label="Select ${real_name}">
                </label>
            </div>
            ${newBadge}
            <div class="user-image-container" style="position: relative;">
                <img src="${profileImage ? profileImage : defaultImage}"
                     class="user-avatar"
                     onerror="if(!this.src.includes('default_profile_')){this.src='${defaultImage}';}"
                     loading="lazy"
                     style="width: 100%; object-fit: cover;">
                ${onlineDot}
            </div>
            <div class="user-info" style="padding: 1rem;">
                <div style="font-weight: 600; color: #00b894; margin-bottom: 0.25rem; font-size: 1.08rem; display: flex; align-items: center; justify-content: center; gap: 0.3rem; flex-wrap: wrap;">
                    ${real_name} ${genderIconHtml} ${ageBadgeHtml} ${compatibilityBadge}
                </div>
                <div style="font-size: 1.02rem; color: var(--muted-color); margin-bottom: 0.5rem; text-align: center;">
                    <i class="fas fa-map-marker-alt"></i> ${location}
                </div>
                ${interestsHtml}
                ${aboutHtml}
                <div class="user-actions">
                    <span class="icon-action icon-message" title="Message" onclick="event.stopPropagation(); openConversation(${userId})">
                        <i class="fas fa-envelope"></i>
                    </span>
                    <span class="icon-action icon-like" title="Like" onclick="event.stopPropagation(); likeUser(${userId})">
                        <i class="fas fa-thumbs-up"></i>
                    </span>
                    <span class="icon-action icon-favourite" title="Add to Favourite" onclick="event.stopPropagation(); addFavorite(${userId})">
                        <i class="fas fa-heart"></i>
                    </span>
                </div>
            </div>
        </div>
    `;
    } else {
        // List view layout
        return `
        <div class="online-user-card" data-user-id="${userId}" onclick="viewProfile(${userId})" style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(31,38,135,0.08); transition: transform 0.2s; cursor: pointer; position: relative; display: flex; flex-direction: row; align-items: stretch; max-width: 100%; box-sizing: border-box;">
            <div class="match-card-checkbox" style="position: absolute; top: 0.5rem; left: 0.5rem; z-index: 10;">
                <label for="match-select-list-${userId}" style="cursor: pointer; display: block;">
                    <input type="checkbox" class="match-select" id="match-select-list-${userId}" data-user-id="${userId}" onclick="event.stopPropagation(); toggleSelection(${userId})" aria-label="Select ${real_name}">
                </label>
            </div>
            ${newBadge}
            <div class="user-image-container" style="position: relative; width: 200px; min-width: 200px; height: 200px; overflow: hidden; border-radius: 12px 0 0 12px; background: #f0f0f0; flex-shrink: 0;">
                <img src="${profileImage ? profileImage : defaultImage}"
                     class="user-avatar"
                     onerror="if(!this.src.includes('default_profile_')){this.src='${defaultImage}';}"
                     loading="lazy"
                     style="width: 100%; object-fit: cover;">
                ${onlineDot}
            </div>
            <div class="user-info" style="padding: 1.5rem; flex: 1; display: flex; flex-direction: column; justify-content: space-between;">
                <div>
                    <div style="font-weight: 600; color: #00b894; margin-bottom: 0.5rem; font-size: 1.2rem; display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap;">
                        ${real_name} ${genderIconHtml} ${ageBadgeHtml} ${compatibilityBadge}
                    </div>
                    <div style="font-size: 1rem; color: var(--muted-color); margin-bottom: 0.75rem;">
                        <i class="fas fa-map-marker-alt"></i> ${location}
                    </div>
                    ${interestsHtml}
                    ${aboutHtml}
                </div>
                <div class="user-actions">
                    <span class="icon-action icon-message" title="Message" onclick="event.stopPropagation(); openConversation(${userId})">
                        <i class="fas fa-envelope"></i>
                    </span>
                    <span class="icon-action icon-like" title="Like" onclick="event.stopPropagation(); likeUser(${userId})">
                        <i class="fas fa-thumbs-up"></i>
                    </span>
                    <span class="icon-action icon-favourite" title="Add to Favourite" onclick="event.stopPropagation(); addFavorite(${userId})">
                        <i class="fas fa-heart"></i>
                    </span>
                </div>
            </div>
        </div>
    `;
    }
}

// Apply filters and sort
function applyFiltersAndSort() {
    filteredMatches = [...allMatches];

    // Apply search filter (location only)
    if (filters.search) {
        const searchLower = filters.search.toLowerCase();
        filteredMatches = filteredMatches.filter(match => {
            const location = (match.location || match.city || '').toLowerCase();
            return location.includes(searchLower);
        });
    }

    // Apply online filter
    if (filters.onlineOnly) {
        filteredMatches = filteredMatches.filter(match => match.is_online);
    }

    // Apply photos filter
    if (filters.withPhotos) {
        filteredMatches = filteredMatches.filter(match => {
            const hasPhoto = match.profile_image && 
                !match.profile_image.includes('default_profile_female.svg') &&
                !match.profile_image.includes('default_profile_male.svg');
            return hasPhoto;
        });
    }

    // Apply compatibility score filter (1-100)
    const minScore = parseInt(filters.minCompatibilityScore) || 1;
    if (minScore > 0) {
        filteredMatches = filteredMatches.filter(match => {
            const score = match.compatibility_score || 0;
            return score >= minScore;
        });
    }

    // Apply sorting
    switch (sortBy) {
        case 'compatibility':
            // Sort by highest compatibility score first
            filteredMatches.sort((a, b) => {
                const scoreA = a.compatibility_score || 0;
                const scoreB = b.compatibility_score || 0;
                // Primary: Compatibility score (highest first)
                if (scoreB !== scoreA) {
                    return scoreB - scoreA;
                }
                // Secondary: Mutual likes first
                if (a.is_mutual_like !== b.is_mutual_like) {
                    return b.is_mutual_like ? 1 : -1;
                }
                // Tertiary: Online status
                if (a.is_online !== b.is_online) {
                    return b.is_online ? 1 : -1;
                }
                // Quaternary: Most recent match
                const dateA = a.match_date ? new Date(a.match_date).getTime() : 0;
                const dateB = b.match_date ? new Date(b.match_date).getTime() : 0;
                return dateB - dateA;
            });
            break;
        case 'recent':
            filteredMatches.sort((a, b) => {
                const dateA = a.match_date ? new Date(a.match_date) : new Date(0);
                const dateB = b.match_date ? new Date(b.match_date) : new Date(0);
                return dateB - dateA;
            });
            break;
        case 'oldest':
            filteredMatches.sort((a, b) => {
                const dateA = a.match_date ? new Date(a.match_date) : new Date(0);
                const dateB = b.match_date ? new Date(b.match_date) : new Date(0);
                return dateA - dateB;
            });
            break;
        case 'age-asc':
            filteredMatches.sort((a, b) => {
                const ageA = a.age || calculateAge(a.birthdate) || 0;
                const ageB = b.age || calculateAge(b.birthdate) || 0;
                return ageA - ageB;
            });
            break;
        case 'age-desc':
            filteredMatches.sort((a, b) => {
                const ageA = a.age || calculateAge(a.birthdate) || 0;
                const ageB = b.age || calculateAge(b.birthdate) || 0;
                return ageB - ageA;
            });
            break;
        case 'online':
            filteredMatches.sort((a, b) => {
                if (a.is_online && !b.is_online) return -1;
                if (!a.is_online && b.is_online) return 1;
                return 0;
            });
            break;
    }

    renderMatches();
}

// Render matches
function renderMatches() {
    const container = document.getElementById('matches-users');
    
    if (filteredMatches.length === 0) {
        showEmptyState();
        return;
    }

    // Calculate pagination
    const totalPages = Math.ceil(filteredMatches.length / itemsPerPage);
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const pageMatches = filteredMatches.slice(startIndex, endIndex);

    // Update pagination
    updatePagination(totalPages);

    // Render matches
    container.innerHTML = pageMatches.map(user => renderMatchCard(user, currentView)).join('');
    
    // Set grid class with columns (only for grid view)
    if (currentView === 'list') {
        container.className = 'online-users-grid list-view';
    } else {
        const cardsPerRowSelect = document.getElementById('cardsPerRow');
        const columns = cardsPerRowSelect ? cardsPerRowSelect.value : '4';
        container.className = `online-users-grid columns-${columns}`;
    }

    // Update count
    document.getElementById('matches-count').textContent = `(${filteredMatches.length})`;
}

// Show empty state
function showEmptyState() {
    const container = document.getElementById('matches-users');
    const sessionToken = getSessionToken();
    const tokenParam = sessionToken ? `?token=${sessionToken}` : '';
    container.innerHTML = `
        <div class="empty-state-container">
            <div class="empty-state-content">
                <div class="empty-icon-wrapper">
                    <i class="fas fa-search"></i>
                </div>
                <h2 class="empty-title">No Matches Found</h2>
                <p class="empty-description">We couldn't find any matches that meet your current filters. Try adjusting your search criteria or explore more options.</p>
                <div class="empty-actions">
                    <a href="/search${tokenParam}" class="empty-btn-primary">
                        <i class="fas fa-search"></i>
                        <span>Browse People</span>
                    </a>
                    <a href="/profile-edit${tokenParam}" class="empty-btn-secondary">
                        <i class="fas fa-user-edit"></i>
                        <span>Complete Your Profile</span>
                    </a>
                </div>
            </div>
        </div>
    `;
    container.className = 'empty-state-wrapper';
    
    // Hide pagination when no matches are found
    const pagination = document.getElementById('pagination');
    if (pagination) {
        pagination.style.display = 'none';
    }
}

// Update pagination
function updatePagination(totalPages) {
    const pagination = document.getElementById('pagination');
    const pageInfo = document.getElementById('page-info');
    const prevBtn = document.getElementById('prev-page');
    const nextBtn = document.getElementById('next-page');

    if (totalPages <= 1) {
        pagination.style.display = 'none';
        return;
    }

    pagination.style.display = 'flex';
    pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
    prevBtn.disabled = currentPage === 1;
    nextBtn.disabled = currentPage === totalPages;
}

// Toggle view
function toggleView(view) {
    currentView = view;
    document.querySelectorAll('.view-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.view === view);
    });
    
    const matchesGrid = document.getElementById('matches-users');
    if (matchesGrid) {
        if (view === 'list') {
            // Remove column classes for list view
            matchesGrid.classList.remove('columns-3', 'columns-4', 'columns-5', 'columns-6');
        } else {
            // Restore column classes for grid view
            const cardsPerRowSelect = document.getElementById('cardsPerRow');
            if (cardsPerRowSelect) {
                updateGridColumns(cardsPerRowSelect.value);
            }
        }
    }
    
    renderMatches();
}

// Toggle selection
let selectedMatches = new Set();
function toggleSelection(userId) {
    if (selectedMatches.has(userId)) {
        selectedMatches.delete(userId);
    } else {
        selectedMatches.add(userId);
    }
    updateBulkActions();
}

function updateBulkActions() {
    const bulkActions = document.getElementById('bulk-actions');
    const selectedCount = document.getElementById('selected-count');
    
    if (selectedMatches.size > 0) {
        bulkActions.style.display = 'flex';
        selectedCount.textContent = `${selectedMatches.size} selected`;
    } else {
        bulkActions.style.display = 'none';
    }
}

// Bulk actions
function bulkMessage() {
    const userIds = Array.from(selectedMatches);
    if (userIds.length > 0) {
        // Open conversation with first user, or create group chat
        openConversation(userIds[0]);
    }
}

function bulkFavorite() {
    const userIds = Array.from(selectedMatches);
    userIds.forEach(userId => addFavorite(userId));
    selectedMatches.clear();
    updateBulkActions();
}

function bulkUnmatch() {
    if (!confirm(`Are you sure you want to unmatch ${selectedMatches.size} user(s)?`)) return;
    const userIds = Array.from(selectedMatches);
    userIds.forEach(userId => unmatch(userId));
    selectedMatches.clear();
    updateBulkActions();
    loadMatches(); // Reload matches
}

// Action functions
function openConversation(userId) {
    // Try to get user's name from the match data
    const match = allMatches.find(m => m.id === userId || m.user_id === userId);
    const userName = match ? (match.real_name || match.name || 'User') : 'User';
    
    // Try to open universal message modal first
    if (typeof openUniversalMessageModal === 'function') {
        openUniversalMessageModal(userName, false, null,
            // Success callback
            (data) => {
                showToast('Message sent successfully', 'success');
            },
            // Error callback
            (error) => {
                // Error handling is done by the modal
            }
        );
    } else {
        // Fallback to talk page if modal not available
        const sessionToken = getSessionToken();
        if (sessionToken) {
            window.location.href = `/talk?token=${sessionToken}&user=${userId}`;
        } else {
            window.location.href = `/talk?user=${userId}`;
        }
    }
}

function viewProfile(userId) {
    // Open profile modal instead of redirecting
    if (window.openProfileModal) {
        openProfileModal(userId);
    } else if (window.UserProfileModal && window.UserProfileModal.open) {
        window.UserProfileModal.open(userId);
    } else {
        // Fallback to redirect if modal not available
        console.warn('Profile modal not available, redirecting to profile page');
        window.location.href = `/users/user_profile.html?user=${userId}`;
    }
}

async function likeUser(userId) {
    try {
        const currentUserId = getUserId();
        const sessionToken = getSessionToken();
        
        if (!currentUserId || !sessionToken) {
            showToast('Authentication required', 'error');
            return;
        }
        
        const response = await fetch(`/api/likes?token=${sessionToken}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${sessionToken}`,
                'X-Session-Token': sessionToken,
                'X-User-ID': currentUserId
            },
            body: JSON.stringify({ userId })
        });
        
        const data = await response.json();
        if (data.success) {
            showToast('User liked successfully', 'success');
        } else if (data.alreadyExists) {
            // User is already liked
            showToast(data.message || 'You already liked this user', 'info');
        } else {
            showToast(data.message || data.error || 'Failed to like user', 'error');
        }
    } catch (error) {
        console.error('Error liking user:', error);
        showToast('Failed to like user', 'error');
    }
}

async function addFavorite(userId) {
    try {
        const currentUserId = getUserId();
        const sessionToken = getSessionToken();
        
        if (!currentUserId || !sessionToken) {
            showToast('Authentication required', 'error');
            return;
        }
        
        const response = await fetch(`/api/favorites?token=${sessionToken}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${sessionToken}`,
                'X-Session-Token': sessionToken,
                'X-User-ID': currentUserId
            },
            body: JSON.stringify({ userId })
        });
        
        const data = await response.json();
        if (data.success) {
            showToast('Added to favorites', 'success');
        } else if (data.alreadyExists) {
            // User is already in favorites
            showToast(data.message || 'User is already in your favourites', 'info');
        } else {
            showToast(data.error || 'Failed to add favorite', 'error');
        }
    } catch (error) {
        console.error('Error adding favorite:', error);
        showToast('Failed to add favorite', 'error');
    }
}

async function unmatch(userId) {
    if (!confirm('Are you sure you want to unmatch this user?')) return;
    try {
        const sessionToken = getSessionToken();
        if (!sessionToken) {
            showToast('Authentication required', 'error');
            return;
        }
        // Call unmatch API endpoint
        const currentUserId = getUserId();
        const response = await fetch(`/api/matches/${currentUserId}/unmatch?token=${sessionToken}&userId=${userId}`, {
            method: 'DELETE',
            headers: {
                'Authorization': `Bearer ${sessionToken}`,
                'X-Session-Token': sessionToken,
                'Content-Type': 'application/json'
            }
        });
        const data = await response.json();
        if (data.success) {
            showToast('Unmatched successfully', 'success');
            loadMatches();
        } else {
            showToast(data.error || 'Failed to unmatch', 'error');
        }
    } catch (error) {
        console.error('Error unmatching:', error);
        showToast('Failed to unmatch', 'error');
    }
}

function calculateAge(birthdate) {
    if (!birthdate) return null;
    const today = new Date();
    const birth = new Date(birthdate);
    let age = today.getFullYear() - birth.getFullYear();
    const monthDiff = today.getMonth() - birth.getMonth();
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
        age--;
    }
    return age;
}

// Helper functions
function getUserId() {
    return window.currentUser?.id || '{{userId}}' || null;
}

function getSessionToken() {
    return new URLSearchParams(window.location.search).get('token') || 
           localStorage.getItem('sessionToken') || 
           null;
}

// Save match score preference to database
async function saveMatchScorePreference(minScore) {
    try {
        const userId = getUserId();
        const sessionToken = getSessionToken();
        
        if (!userId || !sessionToken) {
            console.error('User not authenticated');
            return;
        }

        const response = await fetch(`/api/matches/${userId}/match-score-preference`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${sessionToken}`,
                'X-Session-Token': sessionToken
            },
            body: JSON.stringify({
                minCompatibilityScore: minScore
            })
        });

        const data = await response.json();
        
        if (!data.success) {
            console.error('Failed to save match score preference:', data.error);
        }
    } catch (error) {
        console.error('Error saving match score preference:', error);
    }
}

function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.textContent = message;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}

// Setup cards per row control
function setupCardsPerRowControl() {
    const cardsPerRowSelect = document.getElementById('cardsPerRow');
    const matchesGrid = document.getElementById('matches-users');
    
    if (cardsPerRowSelect && matchesGrid) {
        // Use default value
        const defaultPreference = '4';
        cardsPerRowSelect.value = defaultPreference;
        updateGridColumns(defaultPreference);
        
        cardsPerRowSelect.addEventListener('change', function(e) {
            const value = e.target.value;
            updateGridColumns(value);
        });
    }
}

// Update grid columns
function updateGridColumns(value) {
    const matchesGrid = document.getElementById('matches-users');
    if (!matchesGrid) return;
    
    // Remove all column classes
    matchesGrid.classList.remove('columns-3', 'columns-4', 'columns-5', 'columns-6');
    
    // Add the selected column class (only if not in list view)
    if (!matchesGrid.classList.contains('list-view')) {
        matchesGrid.classList.add(`columns-${value}`);
    }
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Adjust items per page based on screen size
    function adjustItemsPerPage() {
        if (window.innerWidth <= 480) {
            itemsPerPage = 6; // Very small screens
        } else if (window.innerWidth <= 768) {
            itemsPerPage = 8; // Small screens/tablets
        } else {
            itemsPerPage = 12; // Desktop
        }
        // Reset to page 1 when changing items per page
        currentPage = 1;
    }
    
    // Set initial items per page
    adjustItemsPerPage();
    
    // Update on window resize (debounced)
    let resizeTimeout;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
            const oldItemsPerPage = itemsPerPage;
            adjustItemsPerPage();
            // Only reload if items per page actually changed
            if (oldItemsPerPage !== itemsPerPage) {
                renderMatches();
            }
        }, 250);
    });
    
    loadStats();
    loadMatches();

    // Setup cards per row control
    setupCardsPerRowControl();

    // View toggle
    document.querySelectorAll('.view-btn').forEach(btn => {
        btn.addEventListener('click', () => toggleView(btn.dataset.view));
    });

    // Search
    const searchInput = document.getElementById('search-matches');
    if (searchInput) {
        let searchTimeout;
        searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                filters.search = e.target.value;
                currentPage = 1;
                applyFiltersAndSort();
            }, 300);
        });
    }

    // Sort
    const sortSelect = document.getElementById('sort-matches');
    if (sortSelect) {
        sortSelect.addEventListener('change', (e) => {
            sortBy = e.target.value;
            currentPage = 1;
            applyFiltersAndSort();
        });
    }

    // Filters
    document.getElementById('filter-online-only')?.addEventListener('change', (e) => {
        filters.onlineOnly = e.target.checked;
        currentPage = 1;
        applyFiltersAndSort();
    });

    document.getElementById('filter-with-photos')?.addEventListener('change', (e) => {
        filters.withPhotos = e.target.checked;
        currentPage = 1;
        applyFiltersAndSort();
    });

    // Match score slider filter
    const matchScoreSlider = document.getElementById('match-score-slider');
    const matchScoreValue = document.getElementById('match-score-value');
    const matchScoreReset = document.getElementById('match-score-reset');
    
    if (matchScoreSlider && matchScoreValue) {
        // Handle slider input (while dragging)
        matchScoreSlider.addEventListener('input', (e) => {
            const value = parseInt(e.target.value);
            filters.minCompatibilityScore = value;
            matchScoreValue.textContent = value === 1 ? '1%+ (All)' : `${value}%+`;
            applyFiltersAndSort();
        });
        
        // Handle slider change (on release/click)
        matchScoreSlider.addEventListener('change', (e) => {
            const value = parseInt(e.target.value);
            filters.minCompatibilityScore = value;
            // Save preference to database
            saveMatchScorePreference(value);
            currentPage = 1;
            applyFiltersAndSort();
        });
        
        // Reset button - reset to 1% (show all matches)
        if (matchScoreReset) {
            matchScoreReset.addEventListener('click', () => {
                matchScoreSlider.value = 1;
                matchScoreValue.textContent = '1%+ (All)';
                filters.minCompatibilityScore = 1;
                saveMatchScorePreference(1);
                currentPage = 1;
                applyFiltersAndSort();
            });
        }
    }

    // Initialize profile modal
    function initProfileModal() {
        // Wait for modal script to load
        if (window.UserProfileModal) {
            window.UserProfileModal.setGetCurrentUserId(getUserId);
            window.UserProfileModal.setGetSessionToken(getSessionToken);
        } else {
            // Retry after a short delay
            setTimeout(initProfileModal, 100);
        }
    }
    
    // Load profile modal actions
    function loadProfileModalActions() {
        if (typeof window.ProfileModalActions === 'undefined') {
            const script = document.createElement('script');
            script.src = '/components/modals/profile-modal-actions.js';
            script.async = true;
            script.onload = function() {
                if (window.ProfileModalActions) {
                    window.ProfileModalActions.init({
                        getCurrentUserId: getUserId,
                        getCurrentProfileUserId: () => window.getCurrentProfileUserId ? window.getCurrentProfileUserId() : null,
                        getSessionToken: getSessionToken,
                        showNotification: showToast
                    });
                }
            };
            document.head.appendChild(script);
        } else {
            window.ProfileModalActions.init({
                getCurrentUserId: getUserId,
                getCurrentProfileUserId: () => window.getCurrentProfileUserId ? window.getCurrentProfileUserId() : null,
                getSessionToken: getSessionToken,
                showNotification: showToast
            });
        }
    }
    
    // Add event listeners for modal action buttons
    function setupModalButtonHandlers() {
        // Use event delegation for modal buttons (they're dynamically loaded)
        document.addEventListener('click', function(e) {
            // Like button
            if (e.target.closest('.modal-like-btn')) {
                e.preventDefault();
                e.stopPropagation();
                if (window.ProfileModalActions) {
                    window.ProfileModalActions.likeProfileInModal();
                } else {
                    showToast('Profile modal actions not loaded', 'error');
                }
            }
            
            // Favorite button
            if (e.target.closest('.modal-favourite-btn')) {
                e.preventDefault();
                e.stopPropagation();
                if (window.ProfileModalActions) {
                    window.ProfileModalActions.favouriteProfileInModal();
                } else {
                    showToast('Profile modal actions not loaded', 'error');
                }
            }
            
            // Message button
            if (e.target.closest('.modal-message-btn')) {
                e.preventDefault();
                e.stopPropagation();
                messageProfileInModal();
            }
        });
    }
    
    // Message profile in modal
    function messageProfileInModal() {
        const currentProfileUserId = window.getCurrentProfileUserId ? window.getCurrentProfileUserId() : null;
        if (!currentProfileUserId) {
            showToast('Profile not loaded', 'error');
            return;
        }
        
        // Get full real_name from modal (not just first name)
        const real_nameElement = document.getElementById('modal-profile-real_name');
        const real_name = real_nameElement ? real_nameElement.textContent.trim() : 'User';
        
        if (!real_name || real_name === 'Unknown User') {
            showToast('Profile data not loaded correctly. Please refresh the page.', 'error');
            return;
        }
        
        // Close profile modal first
        if (window.closeProfileModal) {
            window.closeProfileModal();
        }
        
        // Open universal message modal with full name
        if (typeof openUniversalMessageModal === 'function') {
            openUniversalMessageModal(real_name, false, null,
                // Success callback
                (data) => {
                    showToast('Message sent successfully', 'success');
                },
                // Error callback
                (error) => {
                    // Error handling is done by the modal
                }
            );
            
            // Set receiverId after modal opens (if available)
            setTimeout(() => {
                if (window.universalMessageData) {
                    window.universalMessageData.receiverId = currentProfileUserId;
                }
            }, 100);
        } else {
            // Fallback to conversation page if modal not available
            openConversation(currentProfileUserId);
        }
    }
    
    // Initialize modals
    initProfileModal();
    loadProfileModalActions();
    setupModalButtonHandlers();

    // Reset filters
    document.getElementById('reset-filters')?.addEventListener('click', () => {
        filters.search = '';
        filters.onlineOnly = false;
        filters.withPhotos = false;
        filters.minCompatibilityScore = 1;
        sortBy = 'compatibility';
        currentPage = 1;
        
        searchInput.value = '';
        sortSelect.value = 'compatibility';
        document.getElementById('filter-online-only').checked = false;
        document.getElementById('filter-with-photos').checked = false;
        
        // Reset match score slider
        const matchScoreSliderReset = document.getElementById('match-score-slider');
        const matchScoreValueReset = document.getElementById('match-score-value');
        if (matchScoreSliderReset && matchScoreValueReset) {
            matchScoreSliderReset.value = 1;
            matchScoreValueReset.textContent = '1%+ (All)';
        }
        
        applyFiltersAndSort();
    });

    // Pagination
    document.getElementById('prev-page')?.addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            renderMatches();
        }
    });

    document.getElementById('next-page')?.addEventListener('click', () => {
        const totalPages = Math.ceil(filteredMatches.length / itemsPerPage);
        if (currentPage < totalPages) {
            currentPage++;
            renderMatches();
        }
    });

    // Load more
    document.getElementById('load-more-btn')?.addEventListener('click', () => {
        const totalPages = Math.ceil(filteredMatches.length / itemsPerPage);
        if (currentPage < totalPages) {
            currentPage++;
            renderMatches();
        }
    });
});
</script>

<style>
/* Smart Matching System Header Styles */
.search-header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color: white;
    padding: 1rem;
    border-radius: 10px;
    margin-bottom: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
}

.search-title h2 {
    margin: 0 0 0.5rem 0;
    font-size: 2rem;
    font-weight: 700;
}

.search-subtitle {
    margin: 0;
    opacity: 0.9;
    font-size: 1.1rem;
}

.search-stats {
    display: flex;
    gap: 0.5rem;
}

.stat-card {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 7.5px;
    padding: 0.5rem;
    text-align: center;
    min-width: 60px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.stat-card i {
    font-size: 0.75rem;
    margin-bottom: 0.25rem;
    display: block;
}

.stat-number {
    display: block;
    font-size: 0.9rem;
    font-weight: 700;
    margin-bottom: 0.1rem;
}

.stat-label {
    font-size: 0.45rem;
    opacity: 0.9;
}


/* Matches Section Styles */
.matches-section {
    max-width: 1200px;
    width: 100%;
    margin: 0 auto;
    box-sizing: border-box;
}

.matches-header {
    background: #fff;
    border-radius: 15px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
}

.header-left h3 {
    margin: 0 0 0.5rem 0;
    color: var(--dark-color);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.matches-count {
    color: var(--muted-color);
    font-weight: normal;
}

.matches-info p {
    margin: 0;
    color: var(--muted-color);
    font-size: 0.9rem;
}

/* View Toggle */
.view-toggle {
    display: flex;
    gap: 0.5rem;
    background: #f5f5f5;
    padding: 0.25rem;
    border-radius: 8px;
}

.view-btn {
    padding: 0.5rem 1rem;
    border: none;
    background: transparent;
    color: var(--muted-color);
    cursor: pointer;
    border-radius: 6px;
    transition: all 0.2s;
}

.view-btn.active {
    background: var(--primary);
    color: white;
}

.view-btn:hover {
    background: rgba(102, 126, 234, 0.1);
}

.view-btn.active:hover {
    background: var(--primary);
}

/* Filters */
.matches-filters {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    display: flex;
    gap: 1.5rem;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 2rem;
}

.filter-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.filter-group label {
    font-weight: 500;
    color: var(--dark-color);
    white-space: nowrap;
}

.match-score-filter {
    flex-wrap: wrap;
    gap: 0.75rem;
    align-items: center;
}

.match-score-slider-container {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    min-width: 200px;
    flex: 1;
    max-width: 400px;
}

.match-score-slider {
    width: 100%;
    height: 8px;
    border-radius: 5px;
    background: #e0e0e0;
    outline: none;
    -webkit-appearance: none;
    cursor: pointer;
}

.match-score-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--primary);
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    transition: all 0.2s;
}

.match-score-slider::-webkit-slider-thumb:hover {
    background: var(--secondary);
    transform: scale(1.1);
}

.match-score-slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--primary);
    cursor: pointer;
    border: none;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    transition: all 0.2s;
}

.match-score-slider::-moz-range-thumb:hover {
    background: var(--secondary);
    transform: scale(1.1);
}

.match-score-display {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
}

.match-score-value {
    font-weight: 600;
    color: var(--dark-color);
    font-size: 0.95rem;
    min-width: 100px;
}

.match-score-reset-btn {
    background: #f5f5f5;
    border: 1px solid #ddd;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 1.2rem;
    line-height: 1;
    color: #666;
    padding: 0;
    transition: all 0.2s;
}

.match-score-reset-btn:hover {
    background: #e0e0e0;
    color: #333;
}

.filter-group input[type="text"],
.filter-group select {
    padding: 0.5rem 1rem;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 0.9rem;
}

.filter-group input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
}

#search-matches {
    min-width: 250px;
    padding-left: 2.5rem;
}

.filter-group:has(#search-matches) {
    position: relative;
}

.filter-group:has(#search-matches) label {
    position: absolute;
    left: 0.75rem;
    color: var(--muted-color);
    pointer-events: none;
}

.filter-reset-btn {
    padding: 0.5rem 1rem;
    background: #f5f5f5;
    border: 1px solid #ddd;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    margin-left: auto;
}

.filter-reset-btn:hover {
    background: #e9e9e9;
}

/* Bulk Actions */
.bulk-actions {
    background: #f8f9fa;
    padding: 1rem 1.5rem;
    border-radius: 12px;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.selected-count {
    font-weight: 600;
    color: var(--dark-color);
    margin-right: auto;
}

.bulk-btn {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.bulk-btn:not(.danger) {
    background: var(--primary);
    color: white;
}

.bulk-btn.danger {
    background: #e74c3c;
    color: white;
}

.bulk-btn:hover {
    opacity: 0.9;
    transform: translateY(-1px);
}

/* Match Cards Grid - Simple grid layout */
.online-users-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
    width: 100%;
    margin: 0 auto 2rem;
    box-sizing: border-box;
    grid-auto-flow: row;
}

/* User Card - Match results.html styling exactly - override layout.html completely */
.online-users-grid .online-user-card {
    background: white !important;
    border-radius: 12px !important;
    overflow: hidden !important;
    box-shadow: 0 2px 8px rgba(31, 38, 135, 0.08) !important;
    transition: transform 0.2s !important;
    position: relative !important;
    display: flex !important;
    flex-direction: column !important;
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    cursor: pointer !important;
    box-sizing: border-box !important;
    padding: 0 !important;
    padding-top: 0 !important;
    padding-bottom: 0 !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
    margin: 0 !important;
    border: none !important;
    border-top: none !important;
}

.online-users-grid .online-user-card:hover {
    transform: translateY(-2px) !important;
}

/* Base image container - applies to columns without specific overrides */
.online-users-grid:not(.columns-3):not(.columns-4):not(.columns-5):not(.columns-6) .online-user-card .user-image-container {
    width: 100% !important;
    min-width: 100% !important;
    max-width: 100% !important;
    height: 140px !important;
    min-height: 140px !important;
    max-height: 140px !important;
    overflow: hidden !important;
    box-sizing: border-box !important;
    position: relative !important;
    border-radius: 12px 12px 0 0 !important;
    margin: 0 !important;
    padding: 0 !important;
    display: block !important;
}

/* Base user avatar - applies to columns without specific overrides */
.online-users-grid:not(.columns-3):not(.columns-4):not(.columns-5):not(.columns-6) .online-user-card .user-avatar {
    width: 100% !important;
    height: 100% !important;
    min-width: 100% !important;
    min-height: 100% !important;
    max-width: 100% !important;
    max-height: 100% !important;
    object-fit: cover !important;
    object-position: center !important;
    border-radius: 12px 12px 0 0 !important;
    display: block !important;
    box-sizing: border-box !important;
    margin: 0 !important;
    padding: 0 !important;
    background: #f0f0f0 !important;
}

/* User Info */
.user-info {
    padding: 1rem;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    text-align: left;
    flex-grow: 1;
    justify-content: space-between;
}

.user-info h4 {
    color: #00b894;
    margin-bottom: 0.25rem;
    font-size: 1.08rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.3rem;
    flex-wrap: wrap;
}

.user-interests {
    margin-bottom: 0.5rem;
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    justify-content: center;
}

.user-interests span {
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    padding: 0.2rem 0.5rem;
    background: #f5f6fa;
    border-radius: 8px;
    font-size: 0.8rem;
    color: #636e72;
}

.user-about {
    font-size: 0.9rem;
    color: #636e72;
    margin-bottom: 1rem;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    max-height: 4.5em;
    line-height: 1.4;
}

/* User Actions */
.user-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: auto;
    flex-wrap: nowrap;
    overflow: hidden;
}

.icon-action {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    color: var(--primary-color);
    cursor: pointer;
    transition: color 0.18s, transform 0.18s;
    padding: 0.5rem;
    border-radius: 50%;
    background: rgba(108, 92, 231, 0.1);
    min-width: 32px;
    min-height: 32px;
    flex-shrink: 0;
}

.icon-action:hover {
    color: var(--danger-color);
    transform: scale(1.1);
    background: rgba(214, 48, 49, 0.1);
}

.icon-like i {
    color: #f39c12;
}

.icon-message i {
    color: var(--primary-color);
}

.icon-favourite i {
    color: var(--danger-color);
}

/* Cards per row column layouts */
.online-users-grid.columns-3 {
    grid-template-columns: repeat(3, 1fr);
    grid-auto-flow: row;
    grid-auto-rows: auto;
}

.online-users-grid.columns-4 {
    grid-template-columns: repeat(4, 1fr);
    grid-auto-flow: row;
    grid-auto-rows: auto;
}

.online-users-grid.columns-5 {
    grid-template-columns: repeat(5, 1fr);
    grid-auto-flow: row;
    grid-auto-rows: auto;
}

.online-users-grid.columns-6 {
    grid-template-columns: repeat(6, 1fr);
    grid-auto-flow: row;
    grid-auto-rows: auto;
}

/* Columns-3 specific overrides */
.online-users-grid.columns-3 .online-user-card {
    border-radius: 15px !important;
    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1) !important;
    transition: transform 0.3s ease !important;
    min-height: 400px !important;
}

.online-users-grid.columns-3 .online-user-card:hover {
    transform: translateY(-5px) !important;
}

.online-users-grid.columns-3 .online-user-card .user-image-container {
    width: 100% !important;
    min-width: 100% !important;
    max-width: 100% !important;
    height: 250px !important;
    min-height: 250px !important;
    max-height: 250px !important;
    overflow: hidden !important;
    box-sizing: border-box !important;
    position: relative !important;
    border-radius: 15px 15px 0 0 !important;
    margin: 0 !important;
    padding: 0 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    background: #f0f0f0 !important;
    flex-shrink: 0 !important;
}

.online-users-grid.columns-3 .online-user-card .user-avatar {
    width: 100% !important;
    height: 100% !important;
    min-width: 100% !important;
    min-height: 100% !important;
    max-width: 100% !important;
    max-height: 100% !important;
    object-fit: contain !important;
    object-position: center center !important;
    border-radius: 15px 15px 0 0 !important;
    display: block !important;
    box-sizing: border-box !important;
    margin: 0 !important;
    padding: 0 !important;
    flex-shrink: 0 !important;
}

.online-users-grid.columns-3 .online-user-card .user-info {
    flex-shrink: 0 !important;
    position: relative !important;
    z-index: 1 !important;
}

.online-users-grid.columns-3 .user-info {
    align-items: center;
    text-align: center;
    flex: 1;
    min-height: 0;
    overflow: visible;
}

/* Consolidated styling for columns-4, 5, 6 - use contain to show full image without cutting */
.online-users-grid.columns-4 .online-user-card .user-image-container,
.online-users-grid.columns-5 .online-user-card .user-image-container,
.online-users-grid.columns-6 .online-user-card .user-image-container {
    width: 100% !important;
    min-width: 100% !important;
    max-width: 100% !important;
    height: 140px !important;
    min-height: 140px !important;
    max-height: 140px !important;
    overflow: hidden !important;
    box-sizing: border-box !important;
    position: relative !important;
    border-radius: 12px 12px 0 0 !important;
    margin: 0 !important;
    padding: 0 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    background: #f0f0f0 !important;
}

.online-users-grid.columns-4 .online-user-card .user-avatar,
.online-users-grid.columns-5 .online-user-card .user-avatar,
.online-users-grid.columns-6 .online-user-card .user-avatar {
    width: 100% !important;
    height: 100% !important;
    min-width: 100% !important;
    min-height: 100% !important;
    max-width: 100% !important;
    max-height: 100% !important;
    object-fit: contain !important;
    object-position: center center !important;
    border-radius: 12px 12px 0 0 !important;
    display: block !important;
    box-sizing: border-box !important;
    margin: 0 !important;
    padding: 0 !important;
}

/* Increase action icon sizes for columns-3 */
.online-users-grid.columns-3 .user-actions {
    gap: 0.39rem !important;
    flex-wrap: nowrap !important;
    justify-content: center !important;
    overflow: hidden !important;
}

.online-users-grid.columns-3 .icon-action {
    font-size: 1.04rem !important;
    padding: 0.39rem !important;
    min-width: 31px !important;
    min-height: 31px !important;
    max-width: 31px !important;
    max-height: 31px !important;
    flex-shrink: 1 !important;
}

.online-users-grid.columns-3 .icon-action i {
    font-size: 1.04rem !important;
}

/* Reduce action icon sizes for columns-4, 5, 6 to fit cards in one row */
.online-users-grid.columns-4 .user-actions {
    gap: 0.3rem !important;
    flex-wrap: nowrap !important;
    justify-content: center !important;
    align-items: center !important;
    overflow: hidden !important;
    display: flex !important;
    width: 100% !important;
}

.online-users-grid.columns-4 .icon-action {
    font-size: 0.8rem !important;
    padding: 0.3rem !important;
    min-width: 24px !important;
    min-height: 24px !important;
    max-width: 24px !important;
    max-height: 24px !important;
    flex-shrink: 1 !important;
}

.online-users-grid.columns-4 .icon-action i {
    font-size: 0.8rem !important;
}

/* Further reduce for columns-5 and 6 */
.online-users-grid.columns-5 .user-actions {
    gap: 0.2rem !important;
    flex-wrap: nowrap !important;
    justify-content: center !important;
    align-items: center !important;
    overflow: hidden !important;
    display: flex !important;
    width: 100% !important;
}

.online-users-grid.columns-6 .user-actions {
    gap: 0.11rem !important;
    flex-wrap: nowrap !important;
    justify-content: center !important;
    align-items: center !important;
    overflow: visible !important;
    display: flex !important;
    width: 100% !important;
    padding: 0 0.2rem !important;
    box-sizing: border-box !important;
}

.online-users-grid.columns-5 .icon-action {
    font-size: 0.7rem !important;
    padding: 0.25rem !important;
    min-width: 20px !important;
    min-height: 20px !important;
    max-width: 20px !important;
    max-height: 20px !important;
    flex-shrink: 1 !important;
}

.online-users-grid.columns-5 .icon-action i {
    font-size: 0.7rem !important;
}

.online-users-grid.columns-6 .icon-action {
    font-size: 0.7rem !important;
    padding: 0.25rem !important;
    min-width: 20px !important;
    min-height: 20px !important;
    max-width: 20px !important;
    max-height: 20px !important;
    flex-shrink: 0 !important;
    box-sizing: border-box !important;
}

.online-users-grid.columns-6 .icon-action i {
    font-size: 0.7rem !important;
}

/* Reduce user-info padding for column-6 to give more space for icons */
.online-users-grid.columns-6 .user-info {
    padding: 0.8rem 0.4rem !important;
}

/* List view layout */
.online-users-grid.list-view {
    grid-template-columns: 1fr;
    gap: 15px;
    max-width: 100%;
    overflow-x: hidden;
}

.online-users-grid.list-view .online-user-card {
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    overflow: hidden;
    display: flex !important;
    flex-direction: row !important;
}

.online-users-grid.list-view .online-user-card .user-image-container {
    flex-shrink: 0;
    max-width: 200px;
    min-width: 150px;
    height: 200px;
}

.online-users-grid.list-view .online-user-card .user-info {
    min-width: 0;
    overflow: hidden;
    word-wrap: break-word;
}

@media (max-width: 768px) {
    .online-users-grid.list-view .online-user-card {
        flex-direction: column !important;
    }
    
    .online-users-grid.list-view .online-user-card .user-image-container {
        width: 100% !important;
        min-width: 100% !important;
        max-width: 100% !important;
        height: 200px !important;
        border-radius: 12px 12px 0 0 !important;
    }

    .online-users-grid.list-view .online-user-card .user-avatar {
        object-fit: contain !important;
    }
}

/* Badge styles */
.new-match-badge {
    position: absolute;
    top: 0.5rem;
    left: 2.5rem;
    background: #f39c12;
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    z-index: 2;
    display: flex;
    align-items: center;
    gap: 0.25rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.compatibility-badge {
    background: rgba(102, 126, 234, 0.9);
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    white-space: nowrap;
}

.compatibility-badge span {
    font-size: 0.7rem;
}

.match-card-checkbox {
    position: absolute;
    top: 0.5rem;
    left: 0.5rem;
    z-index: 10;
}

.match-card-checkbox input {
    width: 20px;
    height: 20px;
    cursor: pointer;
}

.gender-icon {
    font-size: 0.9rem;
}

.gender-icon.male {
    color: #3498db;
}

.gender-icon.female {
    color: #e91e63;
}

.age-badge {
    margin-left: 0.5rem;
    padding: 0.2rem 0.6rem;
    font-size: 0.8rem;
    font-weight: 500;
    border: 1px solid #e0e0e0;
    border-radius: 10px;
    background: #f5f6fa;
    color: #636e72;
    cursor: default;
}

/* Loading States */
.loading-state {
    text-align: center;
    padding: 3rem;
}

.loading-spinner {
    display: none; /* Spinner removed - no spinning animation */
}

.loading-skeleton {
    display: none; /* Skeleton loading removed */
}

.skeleton-card {
    display: none; /* Skeleton cards removed */
}

/* Empty State */
.empty-state-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 500px;
    width: 100%;
    padding: 3rem 1rem;
}

.empty-state-container {
    width: 100%;
    max-width: 600px;
    text-align: center;
}

.empty-state-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
}

.empty-icon-wrapper {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 0.5rem;
    box-shadow: 0 8px 24px rgba(102, 126, 234, 0.25);
}

.empty-icon-wrapper i {
    font-size: 3.5rem;
    color: white;
}

.empty-title {
    font-size: 2rem;
    font-weight: 700;
    color: var(--dark-color);
    margin: 0;
    line-height: 1.3;
}

.empty-description {
    font-size: 1.1rem;
    color: var(--muted-color);
    margin: 0;
    line-height: 1.6;
    max-width: 500px;
}

.empty-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 0.5rem;
}

.empty-btn-primary, .empty-btn-secondary {
    padding: 1rem 2rem;
    border-radius: 12px;
    text-decoration: none;
    font-weight: 600;
    font-size: 1rem;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    border: none;
    cursor: pointer;
}

.empty-btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.empty-btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.empty-btn-secondary {
    background: white;
    color: var(--dark-color);
    border: 2px solid #e9ecef;
}

.empty-btn-secondary:hover {
    background: #f8f9fa;
    border-color: #dee2e6;
    transform: translateY(-2px);
}

.btn-primary, .btn-secondary {
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-primary {
    background: var(--primary);
    color: white;
}

.btn-secondary {
    background: #f5f5f5;
    color: var(--dark-color);
}


/* Error State */
.error-state {
    text-align: center;
    padding: 3rem;
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.error-state i {
    font-size: 3rem;
    color: #e74c3c;
    margin-bottom: 1rem;
}

/* Pagination */
.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin-top: 2rem;
    padding: 1.5rem;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.page-btn {
    padding: 0.5rem 1rem;
    border: 1px solid #ddd;
    background: white;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
}

.page-btn:hover:not(:disabled) {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

.page-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.page-info {
    font-weight: 600;
    color: var(--dark-color);
}

/* Load More */
.load-more-container {
    text-align: center;
    margin-top: 2rem;
}

.load-more-btn {
    padding: 0.75rem 2rem;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.load-more-btn:hover {
    background: var(--secondary);
    transform: translateY(-2px);
}

/* Toast Notifications */
.toast {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    color: white;
    font-weight: 500;
    z-index: 10000;
    animation: slideIn 0.3s ease;
}

.toast-success {
    background: #00b894;
}

.toast-error {
    background: #e74c3c;
}

.toast-info {
    background: #0984e3;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* Mobile Responsive */
@media (max-width: 768px) {
    /* Search Header */
    .search-header {
        flex-direction: column;
        text-align: center;
        padding: 1rem 0.75rem;
        gap: 1rem;
    }

    .search-title h2 {
        font-size: 1.5rem;
        margin-bottom: 0.25rem;
    }

    .search-subtitle {
        font-size: 0.9rem;
    }

    /* Search Stats */
    .search-stats {
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.5rem;
        width: 100%;
    }

    .stat-card {
        flex: 1 1 calc(50% - 0.5rem);
        min-width: calc(50% - 0.5rem);
        max-width: calc(50% - 0.5rem);
        padding: 0.75rem 0.5rem;
    }

    .stat-card i {
        font-size: 0.85rem;
    }

    .stat-number {
        font-size: 0.85rem;
    }

    .stat-label {
        font-size: 0.5rem;
    }

    /* Matches Header */
    .matches-header {
        flex-direction: column;
        align-items: stretch;
        padding: 1.25rem;
        gap: 1rem;
    }

    .header-left h3 {
        font-size: 1.25rem;
        flex-wrap: wrap;
    }

    .matches-info p {
        font-size: 0.85rem;
    }

    .header-right {
        width: 100%;
    }

    .view-toggle {
        width: 100%;
        justify-content: center;
    }

    .view-btn {
        flex: 1;
        padding: 0.6rem;
        text-align: center;
    }

    /* Filters */
    .matches-filters {
        flex-direction: column;
        align-items: stretch;
        padding: 1rem;
        gap: 1rem;
    }

    .filter-group {
        width: 100%;
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }

    .filter-group label {
        width: 100%;
        white-space: normal;
        font-size: 0.9rem;
    }

    #search-matches {
        width: 100%;
        min-width: 100%;
        box-sizing: border-box;
    }

    .filter-group:has(#search-matches) {
        position: relative;
    }

    .match-score-filter {
        width: 100%;
    }

    .match-score-slider-container {
        width: 100%;
        min-width: 100%;
        max-width: 100%;
    }

    .match-score-value {
        font-size: 0.85rem;
        min-width: auto;
    }

    .filter-reset-btn {
        width: 100%;
        margin-left: 0;
        margin-top: 0.5rem;
        padding: 0.75rem;
        justify-content: center;
    }

    .filter-group input[type="text"],
    .filter-group select {
        width: 100%;
        box-sizing: border-box;
    }

    /* Bulk Actions */
    .bulk-actions {
        flex-direction: column;
        align-items: stretch;
        padding: 1rem;
        gap: 0.75rem;
    }

    .selected-count {
        margin-right: 0;
        margin-bottom: 0.5rem;
        text-align: center;
        width: 100%;
    }

    .bulk-btn {
        width: 100%;
        justify-content: center;
        padding: 0.75rem;
    }

    /* Grid Layout - Force 2 columns on mobile same as results.html */
    .online-users-grid {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 0.75rem;
        padding: 0 0.5rem;
    }

    .online-users-grid.columns-3,
    .online-users-grid.columns-4,
    .online-users-grid.columns-5,
    .online-users-grid.columns-6 {
        grid-template-columns: repeat(2, 1fr) !important;
    }

    @media (max-width: 480px) {
        .online-users-grid {
            grid-template-columns: repeat(2, 1fr) !important;
            gap: 0.75rem;
        }
        
        .online-users-grid.columns-3,
        .online-users-grid.columns-4,
        .online-users-grid.columns-5,
        .online-users-grid.columns-6 {
            grid-template-columns: repeat(2, 1fr) !important;
        }
    }

    /* List View */
    .list-view {
        flex-direction: column;
        text-align: center;
    }

    /* Pagination */
    .pagination {
        flex-direction: column;
        gap: 0.75rem;
        padding: 1rem;
        margin-top: 1.5rem;
    }

    .page-btn {
        width: 100%;
        padding: 0.75rem;
        justify-content: center;
    }

    .page-info {
        order: -1;
        padding: 0.5rem 0;
        font-size: 0.9rem;
    }

    /* Load More Button */
    .load-more-container {
        margin-top: 1.5rem;
        padding: 0 1rem;
    }

    .load-more-btn {
        width: 100%;
        padding: 0.875rem;
        justify-content: center;
    }

    /* Empty State */
    .empty-state-wrapper {
        min-height: 400px;
        padding: 2rem 1rem;
    }

    .empty-icon-wrapper {
        width: 90px;
        height: 90px;
    }

    .empty-icon-wrapper i {
        font-size: 2.25rem;
    }

    .empty-title {
        font-size: 1.35rem;
    }

    .empty-description {
        font-size: 0.95rem;
        padding: 0 0.5rem;
    }

    .empty-actions {
        flex-direction: column;
        width: 100%;
        gap: 0.75rem;
        padding: 0 0.5rem;
    }

    .empty-btn-primary, .empty-btn-secondary {
        width: 100%;
        justify-content: center;
        padding: 0.875rem 1.5rem;
        font-size: 0.95rem;
    }

    /* Match Cards - Mobile Optimizations */
    .online-user-card {
        font-size: 0.9rem;
    }

    .online-user-card .user-info {
        padding: 0.875rem !important;
    }

    .user-actions {
        gap: 0.5rem;
    }
}

/* Extra Small Mobile */
@media (max-width: 480px) {
    .search-title h2 {
        font-size: 1.25rem;
    }

    .search-subtitle {
        font-size: 0.85rem;
    }

    .stat-card {
        flex: 1 1 100%;
        min-width: 100%;
        max-width: 100%;
    }

    .matches-header {
        padding: 1rem;
    }

    .header-left h3 {
        font-size: 1.1rem;
    }

    .matches-filters {
        padding: 0.875rem;
    }

    .online-users-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }

    .empty-title {
        font-size: 1.2rem;
    }

    .empty-description {
        font-size: 0.9rem;
    }
}

</style>
