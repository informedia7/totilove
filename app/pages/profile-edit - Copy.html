<!-- Profile tabs with sub-navigation -->
<div class="profile-tabs">
    <a href="/profile-basic?token={{sessionToken}}" class="tab-btn" id="tab-basic">Basic Info</a>
    <a href="/profile-full?token={{sessionToken}}" class="tab-btn" id="tab-full">Full Info</a>
    <a href="/profile-photos?token={{sessionToken}}" class="tab-btn" id="tab-photos">My Photos</a>
    <a href="/profile-edit?token={{sessionToken}}" class="tab-btn active" id="tab-edit">Edit Profile</a>
</div>

<!-- Edit Profile Form -->
<div id="tab-panel-edit">
    <h3 class="edit-title">
        <i class="fas fa-edit"></i>
        Edit Profile Information
    </h3>
    
    <div class="edit-form-container">
        <div class="edit-cards-container">
            <!-- About Me Column -->
            <div class="profile-column">
                <h2 class="section-title">
                    <i class="fas fa-user"></i>
                    About Me
                </h2>
                <form id="about-me-form" method="POST" action="/api/profile/update">
                    <input type="hidden" name="sessionToken" value="{{sessionToken}}">
                    <input type="hidden" name="userId" value="{{userId}}">
                    <div class="column-cards">
                <!-- Personal Information Card -->
                <div class="card-wrapper">
                    <h4 class="card-title-above">
                        <i class="fas fa-user-circle"></i>
                        Personal Information
                    </h4>
                    <div class="edit-card compact-card">
                        <div class="card-content">
                                <div class="form-group">
                                    <label for="about-edit">About Me:</label>
                                    <textarea id="about-edit" name="aboutMe" placeholder="Tell others about yourself..." rows="4">{{aboutMe}}</textarea>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="gender-edit">Gender: *</label>
                                        <input type="hidden" id="current-gender" value="{{userGenderRaw}}">
                                        <select id="gender-edit" name="gender" required>
                                            <option value="">Select gender</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="country">Country *</label>
                                        <select id="country" name="country" class="form-select" required>
                                            <option value="">Select Country</option>
                                        </select>
                                    </div>
                                    <div class="form-group" id="state-container" style="display: none;">
                                        <label for="state">State <span id="state-required" style="display: none;">*</span></label>
                                        <select id="state" name="state" class="form-select">
                                            <option value="">Select State First</option>
                                        </select>
                                    </div>
                                    <div class="form-group" id="city-container" style="display: none;">
                                        <label for="city">City <span id="city-required" style="display: none;">*</span></label>
                                        <select id="city" name="city" class="form-select">
                                            <option value="">Select City First</option>
                                        </select>
                                    </div>
                                </div>
                        </div>
                    </div>
                </div>
                
                <!-- Physical Appearance Card -->
                <div class="card-wrapper">
                    <h4 class="card-title-above">
                        <i class="fas fa-user"></i>
                        Physical Appearance
                    </h4>
                    <div class="edit-card compact-card">
                        <div class="card-content">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="height-select">Height:</label>
                                    <input type="hidden" id="current-height-reference-id" value="{{height_reference_id}}">
                                    <input type="hidden" id="current-height-cm" value="{{height_cm}}">
                                    <select id="height-select" name="height_reference_id">
                                    <option value="">Select height</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="weight-kg">Weight (kg):</label>
                                    <input type="hidden" id="current-weight-reference-id" value="{{weight_reference_id}}">
                                    <input type="hidden" id="current-weight-kg" value="{{weight_kg}}">
                                    <select id="weight-kg" name="weight_reference_id">
                                        <option value="">Select weight</option>
                                    </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="body-type">Body Type:</label>
                                    <input type="hidden"  id="current-body-type" value="{{bodyTypeName}}">
                                <select id="body-type" name="body_type">
                                    <option value="">Select body type</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="eye-color">Eye Color:</label>
                                    <input type="hidden" id="current-eye-color" value="{{eyeColorName}}">
                                <select id="eye-color" name="eye_color">
                                    <option value="">Select eye color</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="hair-color">Hair Color:</label>
                                    <input type="hidden" id="current-hair-color" value="{{hairColorName}}">
                                <select id="hair-color" name="hair_color">
                                    <option value="">Select hair color</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="ethnicity">Ethnicity:</label>
                                    <input type="hidden" id="current-ethnicity" value="{{ethnicityName}}">
                                <select id="ethnicity" name="ethnicity">
                                    <option value="">Select ethnicity</option>
                                </select>
                            </div>
                                </div>
                        </div>
                    </div>
                </div>
                
                <!-- Career & Education Card -->
                <div class="card-wrapper">
                    <h4 class="card-title-above">
                        <i class="fas fa-graduation-cap"></i>
                        Career & Education
                    </h4>
                    <div class="edit-card compact-card">
                        <div class="card-content">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="religion">Religion:</label>
                                        <input type="hidden" id="current-religion" value="{{religionName}}">
                                        <select id="religion" name="religion">
                                            <option value="">Select religion</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="education">Education:</label>
                                        <input type="hidden" id="current-education" value="{{educationName}}">
                                        <select id="education" name="education">
                                            <option value="">Select education level</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="occupation">Occupation:</label>
                                    <input type="hidden" id="current-occupation" value="{{occupationName}}">
                                    <select id="occupation" name="occupation">
                                        <option value="">Select occupation</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Lifestyle & Habits Section -->
                        <div class="form-section">
                            <div class="form-section-header">
                                <i class="fas fa-heart"></i>
                                <span>Lifestyle & Habits</span>
                            </div>
                            <div class="form-section-content">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="smoking">Smoking:</label>
                                        <input type="hidden" id="current-smoking" value="{{smokingName}}">
                                        <select id="smoking" name="smoking">
                                            <option value="">Select smoking preference</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="drinking">Drinking:</label>
                                        <input type="hidden" id="current-drinking" value="{{drinkingName}}">
                                        <select id="drinking" name="drinking">
                                            <option value="">Select drinking preference</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="exercise">Exercise:</label>
                                        <input type="hidden" id="current-exercise" value="{{exerciseName}}">
                                        <select id="exercise" name="exercise">
                                            <option value="">Select exercise habits</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="living-situation">Living Situation:</label>
                                        <input type="hidden" id="current-living-situation" value="{{livingSituationName}}">
                                        <select id="living-situation" name="living_situation">
                                            <option value="">Select living situation</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="have-children">About Children:</label>
                                        <input type="hidden" id="current-have-children" value="{{haveChildrenName}}">
                                        <input type="hidden" id="current-have-children-id" value="{{haveChildrenId}}">
                                        <select id="have-children" name="have_children">
                                            <option value="">Select children status</option>
                                        </select>
                                    </div>
                                    <div class="form-group" id="number-of-children-container" style="display: none;">
                                        <label for="number-of-children">How many children:</label>
                                        <input type="hidden" id="current-number-of-children" value="{{numberOfChildrenName}}">
                                        <input type="hidden" id="current-number-of-children-id" value="{{numberOfChildrenId}}">
                                        <select id="number-of-children" name="number_of_children">
                                            <option value="">Select number of children</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="income">Income:</label>
                                        <input type="hidden" id="current-income" value="{{incomeName}}">
                                        <select id="income" name="income">
                                            <option value="">Select income range</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="marital-status">Marital Status:</label>
                                        <input type="hidden" id="current-marital-status" value="{{maritalStatusName}}">
                                        <select id="marital-status" name="marital_status">
                                            <option value="">Select marital status</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="lifestyle">Lifestyle:</label>
                                        <input type="hidden" id="current-lifestyle" value="{{lifestyleName}}">
                                        <select id="lifestyle" name="lifestyle">
                                            <option value="">Select lifestyle preference</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="body-art">Body Art:</label>
                                        <input type="hidden" id="current-body-art" value="{{bodyArtName}}">
                                        <select id="body-art" name="body_art">
                                            <option value="">Select body art</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="english-ability">English Ability:</label>
                                        <input type="hidden" id="current-english-ability" value="{{englishAbilityName}}">
                                        <select id="english-ability" name="english_ability">
                                            <option value="">Select English ability</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="relocation">Relocation:</label>
                                        <input type="hidden" id="current-relocation" value="{{relocationName}}">
                                        <select id="relocation" name="relocation">
                                            <option value="">Select relocation preference</option>
                                        </select>
                                    </div>
                                </div>
                        </div>
                    </div>
                </div>
                
                <!-- Interests & Activities Card -->
                <div class="card-wrapper">
                    <h4 class="card-title-above">
                        <i class="fas fa-star"></i>
                        Interests & Activities
                    </h4>
                    <div class="edit-card compact-card">
                        <div class="card-content">
                                <div class="form-group">
                                    <label for="interests-edit">Interests (<span id="selected-interests-count">0</span>/10):</label>
                                    <input type="hidden" id="current-interest-category" value="{{interest_category}}">
                                    <div style="margin-bottom: 1rem;">
                                        <div id="selected-interests" style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1rem;">
                                            <!-- Selected interests will be populated here -->
                                        </div>
                                        <select id="interests-edit" name="interest_categories[]" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; background: white;">
                                            <option value="">Select an interest...</option>
                                            <!-- Interests will be populated here -->
                                        </select>
                                        <p style="font-size: 0.9rem; color: var(--muted-color); margin-top: 0.5rem;">Select interests from the dropdown above</p>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="hobbies-select">Hobbies (<span id="selected-hobbies-count">0</span>/10):</label>
                                    <input type="hidden" id="current-hobbies" value="{{hobbies_list}}">
                                    <div style="margin-bottom: 1rem;">
                                        <div id="selected-hobbies" style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1rem;">
                                            <!-- Selected hobbies will be populated here -->
                                        </div>
                                        <select id="hobbies-select" name="hobbies[]" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; background: white;">
                                            <option value="">Select a hobby...</option>
                                            <!-- Hobbies will be populated here -->
                                        </select>
                                        <p style="font-size: 0.9rem; color: var(--muted-color); margin-top: 0.5rem;">Select hobbies from the dropdown above</p>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                        <label style="margin: 0;">Languages I Speak:</label>
                                        <button type="button" class="manage-languages-btn" id="manage-languages-btn">
                                            <i class="fas fa-language"></i>
                                            Manage Languages
                                        </button>
                                    </div>
                                    <div id="current-languages-display" class="current-languages-display"></div>
                                </div>
                    </div>
                </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="save-btn" id="save-about-me-btn">
                            <i class="fas fa-save"></i>
                            Save About Me
                        </button>
                    </div>
                </form>
            </div>

            <!-- What I'm Looking For Column -->
            <div class="profile-column">
                <h2 class="section-title">
                    <i class="fas fa-search"></i>
                    What I'm Looking For
                </h2>
                <form id="preferences-form" method="POST" action="/api/profile/update">
                    <input type="hidden" name="sessionToken" value="{{sessionToken}}">
                    <input type="hidden" name="userId" value="{{userId}}">
                    <div class="column-cards">
                <!-- Basic Criteria Card -->
                <div class="card-wrapper">
                    <h4 class="card-title-above">
                        <i class="fas fa-filter"></i>
                        Basic Criteria
                    </h4>
                    <div class="edit-card compact-card">
                        <div class="card-content">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="preferred-age-min">Preferred Age Min:</label>
                                        <input type="number" id="preferred-age-min" name="preferred_age_min" value="{{preferredAgeMin}}">
                                    </div>
                                    <div class="form-group">
                                        <label for="preferred-age-max">Preferred Age Max:</label>
                                        <input type="number" id="preferred-age-max" name="preferred_age_max" value="{{preferredAgeMax}}">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="preferred-gender">Preferred Gender:</label>
                                        <input type="hidden" id="current-preferred-gender" value="{{preferredGenderRaw}}">
                                        <select id="preferred-gender" name="preferred_gender">
                                            <option value="">Select preferred gender</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="preferred-distance">Distance (miles):</label>
                                        <input type="number" id="preferred-distance" name="preferred_distance" value="{{preferredDistance}}">
                                    </div>
                                </div>
                        </div>
                    </div>
                </div>
                
                <!-- Physical Preferences Card -->
                <div class="card-wrapper">
                    <h4 class="card-title-above">
                        <i class="fas fa-user"></i>
                        Physical Preferences
                    </h4>
                    <div class="edit-card compact-card">
                        <div class="card-content">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="preferred-height">Preferred Height:</label>
                                        <select id="preferred-height" name="preferred_height_reference_id">
                                            <option value="">Select preferred height</option>
                                            <option value="0">Not important</option>
                                        </select>
                                        <input type="hidden" id="current-preferred-height-reference-id" value="{{preferredHeightReferenceId}}">
                                        <input type="hidden" id="current-preferred-height-cm" value="{{preferredHeight}}">
                                    </div>
                                    <div class="form-group">
                                        <label for="preferred-weight">Preferred Weight:</label>
                                        <select id="preferred-weight" name="preferred_weight_reference_id">
                                            <option value="">Select preferred weight</option>
                                        </select>
                                        <input type="hidden" id="current-preferred-weight-reference-id" value="{{preferredWeightReferenceId}}">
                                        <input type="hidden" id="current-preferred-weight-kg" value="{{preferredWeight}}">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="preferred-body-type">Preferred Body Type:</label>
                                        <input type="hidden" id="current-preferred-body-type" value="{{preferredBodyType}}">
                                        <select id="preferred-body-type" name="preferred_body_type">
                                            <option value="">Select preferred body type</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="preferred-exercise">Preferred Exercise:</label>
                                        <input type="hidden" id="current-preferred-exercise" value="{{preferredExercise}}">
                                        <select id="preferred-exercise" name="preferred_exercise">
                                            <option value="">Select preferred exercise habits</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="preferred-eye-color">Preferred Eye Color:</label>
                                        <input type="hidden" id="current-preferred-eye-color" value="{{preferredEyeColor}}">
                                        <select id="preferred-eye-color" name="preferred_eye_color">
                                            <option value="">Select preferred eye color</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="preferred-hair-color">Preferred Hair Color:</label>
                                        <input type="hidden" id="current-preferred-hair-color" value="{{preferredHairColor}}">
                                        <select id="preferred-hair-color" name="preferred_hair_color">
                                            <option value="">Select preferred hair color</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="preferred-ethnicity">Preferred Ethnicity:</label>
                                    <input type="hidden" id="current-preferred-ethnicity" value="{{preferredEthnicity}}">
                                    <select id="preferred-ethnicity" name="preferred_ethnicity">
                                        <option value="">Select preferred ethnicity</option>
                                    </select>
                                </div>
                        </div>
                    </div>
                </div>
                
                <!-- Education & Beliefs Card -->
                <div class="card-wrapper">
                    <h4 class="card-title-above">
                        <i class="fas fa-graduation-cap"></i>
                        Education & Beliefs
                    </h4>
                    <div class="edit-card compact-card">
                        <div class="card-content">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="preferred-education">Preferred Education:</label>
                                        <input type="hidden" id="current-preferred-education" value="{{preferredEducation}}">
                                        <select id="preferred-education" name="preferred_education">
                                            <option value="">Select preferred education</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="preferred-religion">Preferred Religion:</label>
                                        <input type="hidden" id="current-preferred-religion" value="{{preferredReligion}}">
                                        <select id="preferred-religion" name="preferred_religion">
                                            <option value="">Select preferred religion</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Lifestyle & Habits Section -->
                        <div class="form-section">
                            <div class="form-section-header">
                                <i class="fas fa-heart"></i>
                                <span>Lifestyle & Habits</span>
                            </div>
                            <div class="form-section-content">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="preferred-smoking">Preferred Smoking:</label>
                                        <input type="hidden" id="current-preferred-smoking" value="{{preferredSmoking}}">
                                        <select id="preferred-smoking" name="preferred_smoking">
                                            <option value="">Select preferred smoking</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="preferred-drinking">Preferred Drinking:</label>
                                        <input type="hidden" id="current-preferred-drinking" value="{{preferredDrinking}}">
                                        <select id="preferred-drinking" name="preferred_drinking">
                                            <option value="">Select preferred drinking</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="preferred-children">Preferred Children Status:</label>
                                        <input type="hidden" id="current-preferred-children" value="{{preferredChildren}}">
                                        <select id="preferred-children" name="preferred_children">
                                            <option value="">Select preferred children status</option>
                                        </select>
                                    </div>
                                    <div class="form-group" id="preferred-number-of-children-container" style="display: none;">
                                        <label for="preferred-number-of-children">How many children:</label>
                                        <input type="hidden" id="current-preferred-number-of-children" value="{{preferredNumberOfChildren}}">
                                        <input type="hidden" id="current-preferred-number-of-children-id" value="{{preferredNumberOfChildrenId}}">
                                        <select id="preferred-number-of-children" name="preferred_number_of_children">
                                            <option value="">Select number of children</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="preferred-income">Preferred Income:</label>
                                        <input type="hidden" id="current-preferred-income" value="{{preferredIncome}}">
                                        <select id="preferred-income" name="preferred_income">
                                            <option value="">Select preferred income</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="preferred-marital-status">Preferred Marital Status:</label>
                                        <input type="hidden" id="current-preferred-marital-status" value="{{preferredMaritalStatus}}">
                                        <select id="preferred-marital-status" name="preferred_marital_status">
                                            <option value="">Select preferred marital status</option>
                                        </select>
                                    </div>
                                </div>
                        </div>
                    </div>
                </div>
                
                <!-- Career Card -->
                <div class="card-wrapper">
                    <h4 class="card-title-above">
                        <i class="fas fa-briefcase"></i>
                        Career
                    </h4>
                    <div class="edit-card compact-card">
                        <div class="card-content">
                                <div class="form-group">
                                    <label for="preferred-occupation">Preferred Occupation:</label>
                                    <input type="hidden" id="current-preferred-occupation" value="{{preferredOccupation}}">
                                    <select id="preferred-occupation" name="preferred_occupation">
                                        <option value="">Select preferred occupation</option>
                                    </select>
                                </div>
                        </div>
                    </div>
                </div>
                
                <!-- Additional Preferences Card -->
                <div class="card-wrapper">
                    <h4 class="card-title-above">
                        <i class="fas fa-sliders-h"></i>
                        Additional Preferences
                    </h4>
                    <div class="edit-card compact-card">
                        <div class="card-content">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="preferred-lifestyle">Preferred Lifestyle:</label>
                                        <input type="hidden" id="current-preferred-lifestyle" value="{{preferredLifestyle}}">
                                        <select id="preferred-lifestyle" name="preferred_lifestyle">
                                            <option value="">Select preferred lifestyle</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="preferred-body-art">Preferred Body Art:</label>
                                        <input type="hidden" id="current-preferred-body-art" value="{{preferredBodyArt}}">
                                        <select id="preferred-body-art" name="preferred_body_art">
                                            <option value="">Select preferred body art</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="preferred-english-ability">Preferred English Ability:</label>
                                    <input type="hidden" id="current-preferred-english-ability" value="{{preferredEnglishAbility}}">
                                    <select id="preferred-english-ability" name="preferred_english_ability">
                                        <option value="">Select preferred English ability</option>
                                    </select>
                                </div>
                    </div>
                </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="save-btn" id="save-preferences-btn">
                            <i class="fas fa-save"></i>
                            Save Preferences
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="form-actions-bottom">
        <button type="button" class="cancel-btn">
            <i class="fas fa-times"></i>
            Cancel
        </button>
    </div>
</div>

<!-- Include Languages Modal Component -->
<link rel="stylesheet" href="/components/modals/languages-modal.css">
<script src="/components/modals/languages-modal.js"></script>
<div id="languages-modal-container"></div>

<style>
    /* Profile Sections Container */
    .edit-form-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 1rem;
        margin-top: 1rem;
    }
    
    /* 2 Column Layout - Like Copy file */
    .edit-cards-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
        align-items: start;
    }
    
    /* Profile Column (Left: About Me, Right: What I'm Looking For) */
    .profile-column {
        display: flex;
        flex-direction: column;
        width: 100%;
        align-items: stretch;
        min-height: 0;
    }
    
    .section-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #495057;
        margin: 0 0 1.5rem 0;
        padding-bottom: 1rem;
        border-bottom: 3px solid #667eea;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .section-title i {
        color: #667eea;
        font-size: 1.3rem;
    }
    
    .profile-column form {
        display: flex;
        flex-direction: column;
        width: 100%;
        flex: 1;
        min-height: 0;
    }
    
    /* Column Cards Container - Single column for cards within each section */
    .column-cards {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem;
        margin-bottom: 1.5rem;
        flex: 1;
    }
    
    .profile-column .form-actions {
        margin-top: auto;
        padding-top: 1.5rem;
    }
    
    .card-wrapper {
        display: flex;
        flex-direction: column;
    }
    
    .card-title-above {
        font-size: 1rem;
        font-weight: 600;
        color: #495057;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin: 0 0 0.75rem 0;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #e9ecef;
    }
    
    .card-title-above i {
        color: #667eea;
        font-size: 1.1rem;
    }
    
    .edit-card.compact-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        padding: 1.25rem;
        transition: all 0.3s ease;
    }
    
    .edit-card.compact-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        transform: translateY(-2px);
    }
    
    .edit-card.compact-card .card-header {
        display: none;
    }
    
    .edit-card.compact-card .card-content {
        padding: 0;
    }
    
    /* Responsive Design */
    @media (max-width: 1024px) {
        .edit-cards-container {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
    }
    
    .edit-card.compact-card .form-group {
        margin-bottom: 1rem;
    }
    
    .edit-card.compact-card .form-group:last-child {
        margin-bottom: 0;
    }
    
    .edit-card.compact-card .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    .edit-card.compact-card .form-row:last-child {
        margin-bottom: 0;
    }
    
    .edit-card.compact-card label {
        font-size: 0.9rem;
        font-weight: 500;
        color: #495057;
        margin-bottom: 0.5rem;
        display: block;
    }
    
    .edit-card.compact-card input,
    .edit-card.compact-card select,
    .edit-card.compact-card textarea {
        font-size: 0.9rem;
        padding: 0.6rem 0.75rem;
    }
    
    .edit-card.compact-card textarea {
        min-height: 80px;
    }
    
    /* Remove old form-section styles - no longer needed */
    .form-section {
        margin: 0;
        padding: 0;
        border: none;
    }
    
    .form-section-header,
    .form-section-content {
        display: contents;
    }
</style>
<script>
    // Load languages modal HTML (optimized - load immediately on page load)
    (async function() {
        try {
            // Start loading modal HTML immediately (don't wait for DOMContentLoaded)
            const response = await fetch('/components/modals/languages-modal.html');
            const html = await response.text();
            
            // Wait for DOM to be ready if needed
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    const container = document.getElementById('languages-modal-container');
                    if (container) {
                        container.innerHTML = html;
                        // Initialize modal manager after HTML is loaded
                        if (window.LanguagesModalManager) {
                            window.LanguagesModalManager.init();
                        }
                    }
                });
            } else {
                // DOM already ready
                const container = document.getElementById('languages-modal-container');
                if (container) {
                    container.innerHTML = html;
                    // Initialize modal manager after HTML is loaded
                    if (window.LanguagesModalManager) {
                        window.LanguagesModalManager.init();
                    }
                }
            }
        } catch (error) {
            console.error('Failed to load languages modal:', error);
        }
    })();
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Clear invalid "Not specified" values from number inputs
    const numberInputs = document.querySelectorAll('input[type="number"]');
    numberInputs.forEach(input => {
        if (input.value === 'Not specified' || input.value === '' || isNaN(input.value)) {
            input.value = '';
        }
    });
    
    const aboutMeForm = document.getElementById('about-me-form');
    const preferencesForm = document.getElementById('preferences-form');
    const saveAboutMeBtn = document.getElementById('save-about-me-btn');
    const savePreferencesBtn = document.getElementById('save-preferences-btn');
    const cancelBtn = document.querySelector('.cancel-btn');
    
    // Interests management - multiple selection
    let selectedInterests = [];
    let allInterests = [];
    // Hobbies management - multiple selection
    let selectedHobbies = [];
    let allHobbies = [];
    
    // Languages management - use LanguagesModalManager
    const currentLanguagesDisplay = document.getElementById('current-languages-display');
    
    // Reference to LanguagesModalManager (will be available after modal loads)
    let languagesModalManager = null;
    let languagesData = { languages: [], fluencyLevels: [] };
    
    // Load lookup data for dropdowns
    async function loadLookupData() {
        try {
            const urlParams = new URLSearchParams(window.location.search);
            const sessionToken = urlParams.get('token');
            
            if (!sessionToken) {
                throw new Error('No session token found');
            }
            
            const fetchUrl = `/api/profile/lookup-data?sessionToken=${sessionToken}`;
            const response = await fetch(fetchUrl);
            const result = await response.json();
            
            if (result && result.success) {
                const data = result.data || {};
                // Store languages and fluency levels for language management
                languagesData = {
                    languages: data.languages || [],
                    fluencyLevels: data.fluencyLevels || []
                };
                if (window.LanguagesModalManager) {
                    window.LanguagesModalManager.languagesData = languagesData;
                    languagesModalManager = window.LanguagesModalManager;
                }
                populateDropdowns(data);
            } else {
                throw new Error(result && result.error ? result.error : 'Failed to load lookup data');
            }
        } catch (error) {
            showNotification('Failed to load form options. Please refresh the page.', 'error');
        }
    }
    
    function toggleNumberOfChildrenVisibility() {
        const haveChildrenSelect = document.getElementById('have-children');
        const numberChildrenContainer = document.getElementById('number-of-children-container');
        const numberChildrenSelect = document.getElementById('number-of-children');
        if (!haveChildrenSelect || !numberChildrenContainer || !numberChildrenSelect) return;
        
        const value = haveChildrenSelect.value;
        const show = value === '2' || value === '3';
        numberChildrenContainer.style.display = show ? 'block' : 'none';
        numberChildrenSelect.required = show;
        if (!show) {
            numberChildrenSelect.value = '';
        }
    }
    
    function togglePreferredNumberOfChildrenVisibility() {
        const preferredChildrenSelect = document.getElementById('preferred-children');
        const preferredNumberChildrenContainer = document.getElementById('preferred-number-of-children-container');
        const preferredNumberChildrenSelect = document.getElementById('preferred-number-of-children');
        if (!preferredChildrenSelect || !preferredNumberChildrenContainer || !preferredNumberChildrenSelect) return;
        
        const value = preferredChildrenSelect.value;
        const show = value === 'Has children';
        preferredNumberChildrenContainer.style.display = show ? 'block' : 'none';
        preferredNumberChildrenSelect.required = show;
        if (!show) {
            preferredNumberChildrenSelect.value = '';
        }
    }
    
    // Populate dropdown fields with data
    function populateDropdowns(data) {
        // Gender - Map database values (M/F) to dropdown values (Male/Female)
        const genderSelect = document.getElementById('gender-edit');
        if (genderSelect && data.genders) {
            const currentGenderRaw = document.getElementById('current-gender')?.value?.trim() || '';
            // Map database values to display values
            const genderMap = { 'male': 'Male', 'female': 'Female', 'm': 'Male', 'f': 'Female', 'Male': 'Male', 'Female': 'Female' };
            const currentGenderDisplay = genderMap[currentGenderRaw] || '';
            
            data.genders.forEach(gender => {
                const option = document.createElement('option');
                option.value = gender.name;
                option.textContent = gender.name;
                if (gender.name === currentGenderDisplay) {
                    option.selected = true;
                }
                genderSelect.appendChild(option);
            });
        }
        
        // Body types - READ FROM HIDDEN INPUT (same pattern as Preferences)
        const bodyTypeSelect = document.getElementById('body-type');
        if (bodyTypeSelect && data.bodyTypes) {
            const currentBodyTypeInput = document.getElementById('current-body-type');
            const currentBodyType = currentBodyTypeInput?.value?.trim() || '';
            data.bodyTypes.forEach(type => {
                // Skip "Not important" option in About Me section
                if (type.name === 'Not important') return;
                const option = document.createElement('option');
                option.value = type.name;
                option.textContent = type.name;
                if (type.name && type.name.toLowerCase() === (currentBodyType || '').toLowerCase()) {
                    option.selected = true;
                }
                bodyTypeSelect.appendChild(option);
            });
        }
        
        // Eye colors - READ FROM HIDDEN INPUT (same pattern as Preferences)
        const eyeColorSelect = document.getElementById('eye-color');
        if (eyeColorSelect && data.eyeColors) {
            const currentEyeColorInput = document.getElementById('current-eye-color');
            const currentEyeColor = currentEyeColorInput?.value?.trim() || '';
            data.eyeColors.forEach(color => {
                // Skip "Not important" option in About Me section
                if (color.name === 'Not important') return;
                const option = document.createElement('option');
                option.value = color.name;
                option.textContent = color.name;
                if (color.name && color.name.toLowerCase() === (currentEyeColor || '').toLowerCase()) {
                    option.selected = true;
                }
                eyeColorSelect.appendChild(option);
            });
        }
        
        // Hair colors - READ FROM HIDDEN INPUT (same pattern as Preferences)
        const hairColorSelect = document.getElementById('hair-color');
        if (hairColorSelect && data.hairColors) {
            const currentHairColorInput = document.getElementById('current-hair-color');
            const currentHairColor = currentHairColorInput?.value?.trim() || '';
            data.hairColors.forEach(color => {
                // Skip "Not important" option in About Me section
                if (color.name === 'Not important') return;
                const option = document.createElement('option');
                option.value = color.name;
                option.textContent = color.name;
                if (color.name && color.name.toLowerCase() === (currentHairColor || '').toLowerCase()) {
                    option.selected = true;
                }
                hairColorSelect.appendChild(option);
            });
        }
        
        // Ethnicities - READ FROM HIDDEN INPUT (same pattern as Preferences)
        const ethnicitySelect = document.getElementById('ethnicity');
        if (ethnicitySelect && data.ethnicities) {
            const currentEthnicityInput = document.getElementById('current-ethnicity');
            const currentEthnicity = currentEthnicityInput?.value?.trim() || '';
            data.ethnicities.forEach(ethnicity => {
                // Skip "Not important" option in About Me section
                if (ethnicity.name === 'Not important') return;
                const option = document.createElement('option');
                option.value = ethnicity.name;
                option.textContent = ethnicity.name;
                if (ethnicity.name && ethnicity.name.toLowerCase() === (currentEthnicity || '').toLowerCase()) {
                    option.selected = true;
                }
                ethnicitySelect.appendChild(option);
            });
        }
        
        // Religions - READ FROM HIDDEN INPUT (same pattern as Preferences)
        const religionSelect = document.getElementById('religion');
        if (religionSelect && data.religions) {
            const currentReligionInput = document.getElementById('current-religion');
            const currentReligion = currentReligionInput?.value?.trim() || '';
            data.religions.forEach(religion => {
                // Skip "Not important" option in About Me section
                if (religion.name === 'Not important') return;
                const option = document.createElement('option');
                option.value = religion.name;
                option.textContent = religion.name;
                if (religion.name && religion.name.toLowerCase() === (currentReligion || '').toLowerCase()) {
                    option.selected = true;
                }
                religionSelect.appendChild(option);
            });
        }

        // Heights (KEEP existing logic - it works)
        const heightSelect = document.getElementById('height-select');
        if (heightSelect && data.heights) {
            const currentHeightRefIdInput = document.getElementById('current-height-reference-id');
            const currentHeightCmInput = document.getElementById('current-height-cm');
            const currentHeightRefId = currentHeightRefIdInput ? currentHeightRefIdInput.value.trim() : '';
            const currentHeightCm = currentHeightCmInput ? currentHeightCmInput.value.trim() : '';
            
            const isValidId = currentHeightRefId && 
                             currentHeightRefId !== '' && 
                             currentHeightRefId !== 'undefined' && 
                             currentHeightRefId !== 'null' &&
                             !isNaN(currentHeightRefId);
            const isValidCm = currentHeightCm && 
                             currentHeightCm !== '' && 
                             currentHeightCm !== 'undefined' && 
                             currentHeightCm !== 'null' &&
                             !isNaN(currentHeightCm);
            
            let found = false;
            
            data.heights.forEach(height => {
                // Skip "Not important" option in About Me section
                if (height.display_text === 'Not important') return;
                const option = document.createElement('option');
                option.value = height.id;
                // Use display_text if available (for special options), otherwise format numeric height
                if (height.display_text) {
                    option.textContent = height.display_text;
                } else if (height.height_cm !== null && height.height_cm !== undefined) {
                    option.textContent = `${height.height_cm} cm`;
                } else {
                    option.textContent = 'N/A';
                }
                
                if (!found) {
                    if (isValidId && height.id == currentHeightRefId) {
                        option.selected = true;
                        found = true;
                    } else if (isValidCm && !isValidId && height.height_cm != null && height.height_cm == currentHeightCm) {
                        option.selected = true;
                        found = true;
                    }
                }
                
                heightSelect.appendChild(option);
            });
        }
        
        // Weights (KEEP existing logic - it works)
        const weightSelect = document.getElementById('weight-kg');
        if (weightSelect && data.weights) {
            const currentWeightRefIdInput = document.getElementById('current-weight-reference-id');
            const currentWeightKgInput = document.getElementById('current-weight-kg');
            const currentWeightRefId = currentWeightRefIdInput ? currentWeightRefIdInput.value.trim() : '';
            const currentWeightKg = currentWeightKgInput ? currentWeightKgInput.value.trim() : '';
            
            const isValidId = currentWeightRefId && 
                             currentWeightRefId !== '' && 
                             currentWeightRefId !== 'undefined' && 
                             currentWeightRefId !== 'null' &&
                             !isNaN(currentWeightRefId);
            const isValidKg = currentWeightKg && 
                             currentWeightKg !== '' && 
                             currentWeightKg !== 'undefined' && 
                             currentWeightKg !== 'null' &&
                             !isNaN(currentWeightKg);
            
            let found = false;
            
            data.weights.forEach(weight => {
                // Skip "Not important" option in About Me section
                if (weight.display_text === 'Not important') return;
                const option = document.createElement('option');
                option.value = weight.id;
                // Use display_text if available (for special options), otherwise format numeric weight
                if (weight.display_text) {
                    option.textContent = weight.display_text;
                } else if (weight.weight_kg !== null && weight.weight_kg !== undefined) {
                    option.textContent = `${weight.weight_kg} kg`;
                } else {
                    option.textContent = 'N/A';
                }
                
                if (!found) {
                    if (isValidId && weight.id == currentWeightRefId) {
                        option.selected = true;
                        found = true;
                    } else if (isValidKg && !isValidId && weight.weight_kg != null && weight.weight_kg == currentWeightKg) {
                        option.selected = true;
                        found = true;
                    }
                }
                
                weightSelect.appendChild(option);
            });
            
            if (isValidId && currentWeightRefId) {
                weightSelect.value = String(currentWeightRefId);
            }
        }
        
        // Income ranges - READ FROM HIDDEN INPUT (same pattern as Preferences)
        const incomeSelect = document.getElementById('income');
        if (incomeSelect && data.incomeRanges) {
            const currentIncomeInput = document.getElementById('current-income');
            const currentIncome = currentIncomeInput?.value?.trim() || '';
            data.incomeRanges.forEach(income => {
                // Skip "Not important" option in About Me section
                if (income.name === 'Not important') return;
                const option = document.createElement('option');
                option.value = income.name;
                option.textContent = income.name;
                if (income.name && income.name.toLowerCase() === (currentIncome || '').toLowerCase()) {
                    option.selected = true;
                }
                incomeSelect.appendChild(option);
            });
        }
        
        // Marital statuses - READ FROM HIDDEN INPUT (same pattern as Preferences)
        const maritalStatusSelect = document.getElementById('marital-status');
        if (maritalStatusSelect && data.maritalStatuses) {
            const currentMaritalStatusInput = document.getElementById('current-marital-status');
            const currentMaritalStatus = currentMaritalStatusInput?.value?.trim() || '';
            data.maritalStatuses.forEach(status => {
                // Skip "Not important" option in About Me section
                if (status.name === 'Not important') return;
                const option = document.createElement('option');
                option.value = status.name;
                option.textContent = status.name;
                if (status.name && status.name.toLowerCase() === (currentMaritalStatus || '').toLowerCase()) {
                    option.selected = true;
                }
                maritalStatusSelect.appendChild(option);
            });
        }
        
        // Lifestyle preferences - READ FROM HIDDEN INPUT (same pattern as Preferences)
        const lifestyleSelect = document.getElementById('lifestyle');
        if (lifestyleSelect && data.lifestylePreferences) {
            const currentLifestyleInput = document.getElementById('current-lifestyle');
            const currentLifestyle = currentLifestyleInput?.value?.trim() || '';
            data.lifestylePreferences.forEach(lifestyle => {
                // Skip "Not important" option in About Me section
                if (lifestyle.name === 'Not important') return;
                const option = document.createElement('option');
                option.value = lifestyle.name;
                option.textContent = lifestyle.name;
                if (lifestyle.name && lifestyle.name.toLowerCase() === (currentLifestyle || '').toLowerCase()) {
                    option.selected = true;
                }
                lifestyleSelect.appendChild(option);
            });
        }
        
        // Body art - READ FROM HIDDEN INPUT (same pattern as Preferences)
        const bodyArtSelect = document.getElementById('body-art');
        if (bodyArtSelect && data.bodyArt) {
            const currentBodyArtInput = document.getElementById('current-body-art');
            const currentBodyArt = currentBodyArtInput?.value?.trim() || '';
            data.bodyArt.forEach(art => {
                // Skip "Not important" option in About Me section
                if (art.name === 'Not important') return;
                const option = document.createElement('option');
                option.value = art.name;
                option.textContent = art.name;
                if (art.name && art.name.toLowerCase() === (currentBodyArt || '').toLowerCase()) {
                    option.selected = true;
                }
                bodyArtSelect.appendChild(option);
            });
        }
        
        // English ability - READ FROM HIDDEN INPUT (same pattern as Preferences)
        const englishAbilitySelect = document.getElementById('english-ability');
        if (englishAbilitySelect && data.englishAbility) {
            const currentEnglishAbilityInput = document.getElementById('current-english-ability');
            const currentEnglishAbility = currentEnglishAbilityInput?.value?.trim() || '';
            data.englishAbility.forEach(ability => {
                // Skip "Not important" option in About Me section
                if (ability.name === 'Not important') return;
                const option = document.createElement('option');
                option.value = ability.name;
                option.textContent = ability.name;
                if (ability.name && ability.name.toLowerCase() === (currentEnglishAbility || '').toLowerCase()) {
                    option.selected = true;
                }
                englishAbilitySelect.appendChild(option);
            });
        }
        
        // Relocation preferences - READ FROM HIDDEN INPUT (same pattern as Preferences)
        const relocationSelect = document.getElementById('relocation');
        if (relocationSelect && data.relocationPreferences) {
            const currentRelocationInput = document.getElementById('current-relocation');
            const currentRelocation = currentRelocationInput?.value?.trim() || '';
            data.relocationPreferences.forEach(relocation => {
                // Skip "Not important" option in About Me section
                if (relocation.name === 'Not important') return;
                const option = document.createElement('option');
                option.value = relocation.name;
                option.textContent = relocation.name;
                if (relocation.name && relocation.name.toLowerCase() === (currentRelocation || '').toLowerCase()) {
                    option.selected = true;
                }
                relocationSelect.appendChild(option);
            });
        }
        
        // Interest categories - Multiple selection support
        const interestsSelect = document.getElementById('interests-edit');
        if (interestsSelect) {
            const currentInterestCategoryInput = document.getElementById('current-interest-category');
            const currentInterestCategory = currentInterestCategoryInput?.value?.trim() || '';
            const candidates = (data && (data.interestCategories || data.interests || data.interest_category_list || data.interest_category)) || [];
            
            // Clear and reset
            allInterests = [];
            selectedInterests = [];
            
            if (Array.isArray(candidates) && candidates.length > 0) {
                // Store all interests
                candidates.forEach(category => {
                    try {
                        const interest = {
                            id: category.id != null ? category.id : null,
                            name: category.name || category.label || category.slug || String(category.id || ''),
                            icon: category.icon || category.emoji || '',
                            value: category.name || category.label || category.slug || String(category.id || '')
                        };
                        allInterests.push(interest);
                        
                        // Create dropdown option
                        const option = document.createElement('option');
                        option.value = interest.id != null ? String(interest.id) : interest.value;
                        option.textContent = interest.icon ? `${interest.icon} ${interest.name}` : interest.name;
                        option.dataset.id = String(interest.id || '');
                        interestsSelect.appendChild(option);
                    } catch (err) {
                        // Silently skip invalid interest options
                    }
                });
                
                // Handle current selected interests (could be single or multiple)
                // Check if currentInterestCategory is a comma-separated list or single value
                if (currentInterestCategory) {
                    const currentInterests = currentInterestCategory.split(',').map(s => s.trim()).filter(s => s);
                    currentInterests.forEach(interestName => {
                        const interest = allInterests.find(i => 
                            i.name.toLowerCase() === interestName.toLowerCase() ||
                            i.value.toLowerCase() === interestName.toLowerCase()
                        );
                        if (interest && !selectedInterests.find(si => si.id === interest.id || si.name === interest.name)) {
                            selectedInterests.push(interest);
                        }
                    });
                }
                
                // Update display
                updateSelectedInterestsDisplay();
            }
        }
        
        // Hobbies - Multiple selection support (user_hobbies_reference)
        const hobbiesSelect = document.getElementById('hobbies-select');
        if (hobbiesSelect) {
            const currentHobbiesInput = document.getElementById('current-hobbies');
            const currentHobbiesRaw = currentHobbiesInput?.value || '';
            const currentHobbies = currentHobbiesRaw
                .split(',')
                .map(s => s.trim())
                .filter(Boolean);

            // Map common Font Awesome hobby icons to emoji for dropdown display
            const faIconToEmoji = (icon) => {
                if (!icon) return '';
                const map = {
                    'fa-music': '',
                    'fa-running': '',
                    'fa-walking': '',
                    'fa-book': '',
                    'fa-camera': '',
                    'fa-film': '',
                    'fa-gamepad': '',
                    'fa-basketball-ball': '',
                    'fa-football-ball': '',
                    'fa-futbol': '',
                    'fa-swimmer': '',
                    'fa-hiking': '',
                    'fa-biking': '',
                    'fa-tree': '',
                    'fa-leaf': '',
                    'fa-paint-brush': '',
                    'fa-dumbbell': '',
                    'fa-car': '',
                    'fa-plane': '',
                    'fa-utensils': '',
                    'fa-cookie-bite': ''
                };
                const key = icon.split(' ').find(k => k.startsWith('fa-'));
                return map[key] || '';
            };
            
            const hobbyCandidates = (data && (data.hobbies || data.hobbies_reference || data.hobbiesReference || data.hobbyCategories || data.hobby_categories)) || [];
            
            allHobbies = [];
            selectedHobbies = [];
            hobbiesSelect.innerHTML = '<option value=\"\">Select a hobby...</option>';
            
            if (Array.isArray(hobbyCandidates) && hobbyCandidates.length > 0) {
                hobbyCandidates.forEach(hobby => {
                    try {
                        const item = {
                            id: hobby.id != null ? hobby.id : null,
                            name: hobby.name || hobby.label || hobby.slug || String(hobby.id || ''),
                            icon: hobby.icon || hobby.emoji || '',
                            value: hobby.name || hobby.label || hobby.slug || String(hobby.id || '')
                        };
                        allHobbies.push(item);
                        
                        const option = document.createElement('option');
                        option.value = item.id != null ? String(item.id) : item.value;
                        // Show only the hobby name (no icons) in the dropdown
                        option.textContent = item.name;
                        option.dataset.id = String(item.id || '');
                        hobbiesSelect.appendChild(option);
                    } catch (err) {
                        // ignore bad hobby rows
                    }
                });
                
                // Preselect current hobbies
                currentHobbies.forEach(hobbyName => {
                    const hobby = allHobbies.find(h => 
                        String(h.id) === hobbyName ||
                        h.name.toLowerCase() === hobbyName.toLowerCase() || 
                        h.value.toLowerCase() === hobbyName.toLowerCase()
                    );
                    if (hobby && !selectedHobbies.find(sh => sh.id === hobby.id || sh.name === hobby.name)) {
                        selectedHobbies.push(hobby);
                    }
                });
                
                updateSelectedHobbiesDisplay();
            }
        }
        
        // Education levels - READ FROM HIDDEN INPUT (same pattern as Preferences)
        const educationSelect = document.getElementById('education');
        if (educationSelect && data.educationLevels) {
            const currentEducationInput = document.getElementById('current-education');
            const currentEducation = currentEducationInput?.value?.trim() || '';
            data.educationLevels.forEach(level => {
                // Skip "Not important" option in About Me section
                if (level.name === 'Not important') return;
                const option = document.createElement('option');
                option.value = level.name;
                option.textContent = level.name;
                if (level.name && level.name.toLowerCase() === (currentEducation || '').toLowerCase()) {
                    option.selected = true;
                }
                educationSelect.appendChild(option);
            });
        }
        
        // Smoking preferences - READ FROM HIDDEN INPUT (same pattern as Preferences)
        const smokingSelect = document.getElementById('smoking');
        if (smokingSelect && data.smokingPreferences) {
            const currentSmokingInput = document.getElementById('current-smoking');
            const currentSmoking = currentSmokingInput?.value?.trim() || '';
            data.smokingPreferences.forEach(pref => {
                // Skip "Not important" option in About Me section
                if (pref.name === 'Not important') return;
                const option = document.createElement('option');
                option.value = pref.name;
                option.textContent = pref.name;
                if (pref.name && pref.name.toLowerCase() === (currentSmoking || '').toLowerCase()) {
                    option.selected = true;
                }
                smokingSelect.appendChild(option);
            });
        }
        
        // Drinking preferences - READ FROM HIDDEN INPUT (same pattern as Preferences)
        const drinkingSelect = document.getElementById('drinking');
        if (drinkingSelect && data.drinkingPreferences) {
            const currentDrinkingInput = document.getElementById('current-drinking');
            const currentDrinking = currentDrinkingInput?.value?.trim() || '';
            data.drinkingPreferences.forEach(pref => {
                // Skip "Not important" option in About Me section
                if (pref.name === 'Not important') return;
                const option = document.createElement('option');
                option.value = pref.name;
                option.textContent = pref.name;
                if (pref.name && pref.name.toLowerCase() === (currentDrinking || '').toLowerCase()) {
                    option.selected = true;
                }
                drinkingSelect.appendChild(option);
            });
        }
        
        // Exercise habits - READ FROM HIDDEN INPUT (same pattern as Preferences)
        const exerciseSelect = document.getElementById('exercise');
        if (exerciseSelect && data.exerciseHabits) {
            const currentExerciseInput = document.getElementById('current-exercise');
            const currentExercise = currentExerciseInput?.value?.trim() || '';
            data.exerciseHabits.forEach(habit => {
                // Skip "Not important" option in About Me section
                if (habit.name === 'Not important') return;
                const option = document.createElement('option');
                option.value = habit.name;
                option.textContent = habit.name;
                if (habit.name && habit.name.toLowerCase() === (currentExercise || '').toLowerCase()) {
                    option.selected = true;
                }
                exerciseSelect.appendChild(option);
            });
        }
        
        // Living situation (from user_living_situations) - READ FROM HIDDEN INPUT
        const livingSituationSelect = document.getElementById('living-situation');
        if (livingSituationSelect && (data.livingSituations || data.childrenStatuses)) {
            const currentLivingSituationInput = document.getElementById('current-living-situation');
            const currentLivingSituation = currentLivingSituationInput?.value?.trim() || '';
            const livingSituations = data.livingSituations || data.childrenStatuses || [];
            livingSituations.forEach(status => {
                // Skip "Not important" option in About Me section
                if (status.name === 'Not important') return;
                const option = document.createElement('option');
                option.value = status.name;
                option.textContent = status.name;
                if (status.name && status.name.toLowerCase() === (currentLivingSituation || '').toLowerCase()) {
                    option.selected = true;
                }
                livingSituationSelect.appendChild(option);
            });
        }
        
        // Have children status (from user_have_children_statuses) - READ FROM HIDDEN INPUT
        const haveChildrenSelect = document.getElementById('have-children');
        if (haveChildrenSelect && (data.haveChildrenStatuses || data.childrenStatuses)) {
            const currentHaveChildrenInput = document.getElementById('current-have-children');
            const currentHaveChildrenIdInput = document.getElementById('current-have-children-id');
            const currentHaveChildren = currentHaveChildrenInput?.value?.trim() || '';
            const currentHaveChildrenId = currentHaveChildrenIdInput?.value?.trim() || '';
            const haveChildrenStatuses = data.haveChildrenStatuses || data.childrenStatuses || [];
            haveChildrenStatuses.forEach(status => {
                // Skip "Not important" option in About Me section
                if (status.name === 'Not important') return;
                const option = document.createElement('option');
                option.value = status.id || status.name;
                option.textContent = status.name;
                const matchesId = currentHaveChildrenId && status.id && String(status.id) === String(currentHaveChildrenId);
                const matchesName = status.name && status.name.toLowerCase() === (currentHaveChildren || '').toLowerCase();
                if (matchesId || matchesName) {
                    option.selected = true;
                }
                haveChildrenSelect.appendChild(option);
            });
        }

        // Number of children (user_number_of_children)
        const numberChildrenSelect = document.getElementById('number-of-children');
        if (numberChildrenSelect && data.numberOfChildren) {
            const currentNumberChildrenInput = document.getElementById('current-number-of-children');
            const currentNumberChildrenIdInput = document.getElementById('current-number-of-children-id');
            const currentNumberChildren = currentNumberChildrenInput?.value?.trim() || '';
            const currentNumberChildrenId = currentNumberChildrenIdInput?.value?.trim() || '';
            data.numberOfChildren.forEach(item => {
                // Skip "Not important" option in About Me section
                if (item.name === 'Not important') return;
                const option = document.createElement('option');
                option.value = item.id || item.name;
                option.textContent = item.name;
                const matchesId = currentNumberChildrenId && item.id && String(item.id) === String(currentNumberChildrenId);
                const matchesName = item.name && item.name.toLowerCase() === (currentNumberChildren || '').toLowerCase();
                if (matchesId || matchesName) {
                    option.selected = true;
                }
                numberChildrenSelect.appendChild(option);
            });
        }
        
        // Occupation - READ FROM HIDDEN INPUT (same pattern as Preferences)
        const occupationSelect = document.getElementById('occupation');
        if (occupationSelect && data.occupationCategories) {
            const currentOccupationInput = document.getElementById('current-occupation');
            const currentOccupation = currentOccupationInput?.value?.trim() || '';
            data.occupationCategories.forEach(category => {
                // Skip "Not important" option in About Me section
                if (category.name === 'Not important') return;
                const option = document.createElement('option');
                option.value = category.name;
                option.textContent = category.name;
                if (category.name && category.name.toLowerCase() === (currentOccupation || '').toLowerCase()) {
                    option.selected = true;
                }
                occupationSelect.appendChild(option);
            });
        }
        
        // PREFERENCE DROPDOWNS - Similar approach
        // Preferred gender
        const preferredGenderSelect = document.getElementById('preferred-gender');
        if (preferredGenderSelect && data.genders) {
            const currentPreferredGender = document.getElementById('current-preferred-gender')?.value?.trim() || '';
            data.genders.forEach(gender => {
                // Skip "Prefer not to say" option in Preferences section
                if (gender.name === 'Prefer not to say') return;
                const option = document.createElement('option');
                option.value = gender.name;
                option.textContent = gender.name;
                if (gender.name && gender.name.toLowerCase() === (currentPreferredGender || '').toLowerCase()) {
                    option.selected = true;
                }
                preferredGenderSelect.appendChild(option);
            });
        }
        
        // Preferred height (KEEP existing logic)
        const preferredHeightSelect = document.getElementById('preferred-height');
        if (preferredHeightSelect && data.heights) {
            const currentPreferredHeightRefIdInput = document.getElementById('current-preferred-height-reference-id');
            const currentPreferredHeightCmInput = document.getElementById('current-preferred-height-cm');
            const currentPreferredHeightRefId = currentPreferredHeightRefIdInput ? currentPreferredHeightRefIdInput.value.trim() : '';
            const currentPreferredHeightCm = currentPreferredHeightCmInput ? currentPreferredHeightCmInput.value.trim() : '';
            
            const isValidId = currentPreferredHeightRefId && 
                             currentPreferredHeightRefId !== '' && 
                             currentPreferredHeightRefId !== 'undefined' && 
                             currentPreferredHeightRefId !== 'null' &&
                             !isNaN(currentPreferredHeightRefId);
            const isValidCm = currentPreferredHeightCm && 
                             currentPreferredHeightCm !== '' && 
                             currentPreferredHeightCm !== 'undefined' && 
                             currentPreferredHeightCm !== 'null' &&
                             !isNaN(currentPreferredHeightCm);
            
            let found = false;
            
            data.heights.forEach(height => {
                // Skip "Prefer not to say" option in Preferences section
                if (height.display_text === 'Prefer not to say') return;
                const option = document.createElement('option');
                option.value = height.id;
                // Use display_text if available (for special options), otherwise format numeric height
                if (height.display_text) {
                    option.textContent = height.display_text;
                } else if (height.height_cm !== null && height.height_cm !== undefined) {
                    option.textContent = `${height.height_cm} cm`;
                } else {
                    option.textContent = 'N/A';
                }
                
                if (!found) {
                    if (isValidId && height.id == currentPreferredHeightRefId) {
                        option.selected = true;
                        found = true;
                    } else if (isValidCm && !isValidId && height.height_cm != null && height.height_cm == currentPreferredHeightCm) {
                        option.selected = true;
                        found = true;
                    }
                }
                
                preferredHeightSelect.appendChild(option);
            });
            
            if (isValidId && currentPreferredHeightRefId) {
                preferredHeightSelect.value = String(currentPreferredHeightRefId);
            }
            
            // Handle "Not important" (value 0)
            if (currentPreferredHeightRefId === '0') {
                preferredHeightSelect.value = '0';
            }
        }
        
        // Preferred weight (similar to height)
        const preferredWeightSelect = document.getElementById('preferred-weight');
        if (preferredWeightSelect && data.weights) {
            const currentPreferredWeightRefIdInput = document.getElementById('current-preferred-weight-reference-id');
            const currentPreferredWeightKgInput = document.getElementById('current-preferred-weight-kg');
            const currentPreferredWeightRefId = currentPreferredWeightRefIdInput ? currentPreferredWeightRefIdInput.value.trim() : '';
            const currentPreferredWeightKg = currentPreferredWeightKgInput ? currentPreferredWeightKgInput.value.trim() : '';
            
            const isValidId = currentPreferredWeightRefId && 
                             currentPreferredWeightRefId !== '' && 
                             currentPreferredWeightRefId !== 'undefined' && 
                             currentPreferredWeightRefId !== 'null' &&
                             !isNaN(currentPreferredWeightRefId);
            const isValidKg = currentPreferredWeightKg && 
                             currentPreferredWeightKg !== '' && 
                             currentPreferredWeightKg !== 'undefined' && 
                             currentPreferredWeightKg !== 'null' &&
                             !isNaN(currentPreferredWeightKg);
            
            let foundMatch = false;
            
            data.weights.forEach(weight => {
                // Skip "Prefer not to say" option in Preferences section
                if (weight.display_text === 'Prefer not to say') return;
                const option = document.createElement('option');
                option.value = weight.id;
                // Use display_text if available (for special options), otherwise format numeric weight
                if (weight.display_text) {
                    option.textContent = weight.display_text;
                } else if (weight.weight_kg !== null && weight.weight_kg !== undefined) {
                    option.textContent = `${weight.weight_kg} kg`;
                } else {
                    option.textContent = 'N/A';
                }
                
                // Set selected if this matches the current preferred weight
                if (isValidId && weight.id == currentPreferredWeightRefId) {
                    option.selected = true;
                    foundMatch = true;
                } else if (isValidKg && !isValidId && weight.weight_kg != null && weight.weight_kg == currentPreferredWeightKg) {
                    option.selected = true;
                    foundMatch = true;
                }
                
                preferredWeightSelect.appendChild(option);
            });
            
            // If no match found, ensure the default "Select preferred weight" option is selected
            if (!foundMatch) {
                preferredWeightSelect.value = '';
            } else if (isValidId && currentPreferredWeightRefId) {
                preferredWeightSelect.value = String(currentPreferredWeightRefId);
            }
        }
        
        // Preferred body type
        const preferredBodyTypeSelect = document.getElementById('preferred-body-type');
        if (preferredBodyTypeSelect && data.bodyTypes) {
            const currentPreferredBodyTypeInput = document.getElementById('current-preferred-body-type');
            const currentPreferredBodyType = currentPreferredBodyTypeInput?.value?.trim() || '';
            data.bodyTypes.forEach(type => {
                // Skip "Prefer not to say" option in Preferences section
                if (type.name === 'Prefer not to say') return;
                const option = document.createElement('option');
                option.value = type.name;
                option.textContent = type.name;
                if (type.name && type.name.toLowerCase() === (currentPreferredBodyType || '').toLowerCase()) {
                    option.selected = true;
                }
                preferredBodyTypeSelect.appendChild(option);
            });
        }
        
        // Preferred education
        const preferredEducationSelect = document.getElementById('preferred-education');
        if (preferredEducationSelect && data.educationLevels) {
            const currentPreferredEducationInput = document.getElementById('current-preferred-education');
            const currentPreferredEducation = currentPreferredEducationInput?.value?.trim() || '';
            data.educationLevels.forEach(level => {
                // Skip "Prefer not to say" option in Preferences section
                if (level.name === 'Prefer not to say') return;
                const option = document.createElement('option');
                option.value = level.name;
                option.textContent = level.name;
                if (level.name && level.name.toLowerCase() === (currentPreferredEducation || '').toLowerCase()) {
                    option.selected = true;
                }
                preferredEducationSelect.appendChild(option);
            });
        }
        
        // Preferred religion
        const preferredReligionSelect = document.getElementById('preferred-religion');
        if (preferredReligionSelect && data.religions) {
            const currentPreferredReligionInput = document.getElementById('current-preferred-religion');
            const currentPreferredReligion = currentPreferredReligionInput?.value?.trim() || '';
            data.religions.forEach(religion => {
                // Skip "Prefer not to say" option in Preferences section
                if (religion.name === 'Prefer not to say') return;
                const option = document.createElement('option');
                option.value = religion.name;
                option.textContent = religion.name;
                if (religion.name && religion.name.toLowerCase() === (currentPreferredReligion || '').toLowerCase()) {
                    option.selected = true;
                }
                preferredReligionSelect.appendChild(option);
            });
        }
        
        // Preferred smoking
        const preferredSmokingSelect = document.getElementById('preferred-smoking');
        if (preferredSmokingSelect && data.smokingPreferences) {
            const currentPreferredSmokingInput = document.getElementById('current-preferred-smoking');
            const currentPreferredSmoking = currentPreferredSmokingInput?.value?.trim() || '';
            data.smokingPreferences.forEach(pref => {
                // Skip "Prefer not to say" option in Preferences section
                if (pref.name === 'Prefer not to say') return;
                const option = document.createElement('option');
                option.value = pref.name;
                option.textContent = pref.name;
                if (pref.name && pref.name.toLowerCase() === (currentPreferredSmoking || '').toLowerCase()) {
                    option.selected = true;
                }
                preferredSmokingSelect.appendChild(option);
            });
        }
        
        // Preferred drinking
        const preferredDrinkingSelect = document.getElementById('preferred-drinking');
        if (preferredDrinkingSelect && data.drinkingPreferences) {
            const currentPreferredDrinkingInput = document.getElementById('current-preferred-drinking');
            const currentPreferredDrinking = currentPreferredDrinkingInput?.value?.trim() || '';
            data.drinkingPreferences.forEach(pref => {
                // Skip "Prefer not to say" option in Preferences section
                if (pref.name === 'Prefer not to say') return;
                const option = document.createElement('option');
                option.value = pref.name;
                option.textContent = pref.name;
                if (pref.name && pref.name.toLowerCase() === (currentPreferredDrinking || '').toLowerCase()) {
                    option.selected = true;
                }
                preferredDrinkingSelect.appendChild(option);
            });
        }
        
        // Preferred children (uses user_preferred_children_statuses data)
        const preferredChildrenSelect = document.getElementById('preferred-children');
        if (preferredChildrenSelect && data.preferredChildrenStatuses) {
            const currentPreferredChildrenInput = document.getElementById('current-preferred-children');
            const currentPreferredChildren = currentPreferredChildrenInput?.value?.trim() || '';
            data.preferredChildrenStatuses.forEach(status => {
                // Skip "Prefer not to say" option in Preferences section
                if (status.name === 'Prefer not to say') return;
                const option = document.createElement('option');
                option.value = status.name;
                option.textContent = status.name;
                if (status.name && status.name.toLowerCase() === (currentPreferredChildren || '').toLowerCase()) {
                    option.selected = true;
                }
                preferredChildrenSelect.appendChild(option);
            });
        }
        
        // Preferred number of children (uses user_number_of_children data)
        // Note: This must be populated AFTER preferred children dropdown to ensure visibility is correct
        const preferredNumberChildrenSelect = document.getElementById('preferred-number-of-children');
        if (preferredNumberChildrenSelect && data.numberOfChildren) {
            const currentPreferredNumberChildrenInput = document.getElementById('current-preferred-number-of-children');
            const currentPreferredNumberChildrenIdInput = document.getElementById('current-preferred-number-of-children-id');
            const currentPreferredNumberChildren = currentPreferredNumberChildrenInput?.value?.trim() || '';
            const currentPreferredNumberChildrenId = currentPreferredNumberChildrenIdInput?.value?.trim() || '';
            let foundMatch = false;
            data.numberOfChildren.forEach(item => {
                // Skip "Prefer not to say" option in Preferences section
                if (item.name === 'Prefer not to say') return;
                // Include "Not important" option in Preferences section
                const option = document.createElement('option');
                option.value = item.name;
                option.textContent = item.name;
                const matchesId = currentPreferredNumberChildrenId && item.id && String(item.id) === String(currentPreferredNumberChildrenId);
                const matchesName = item.name && item.name.toLowerCase() === (currentPreferredNumberChildren || '').toLowerCase();
                if (matchesId || matchesName) {
                    option.selected = true;
                    foundMatch = true;
                }
                preferredNumberChildrenSelect.appendChild(option);
            });
            // If no match found and we have a saved value, try to set it explicitly
            if (!foundMatch && currentPreferredNumberChildren) {
                preferredNumberChildrenSelect.value = currentPreferredNumberChildren;
            }
            // Trigger visibility toggle after populating to ensure field is shown if "Has children" is selected
            togglePreferredNumberOfChildrenVisibility();
        }
        
        // Preferred eye color
        const preferredEyeColorSelect = document.getElementById('preferred-eye-color');
        if (preferredEyeColorSelect && data.eyeColors) {
            const currentPreferredEyeColorInput = document.getElementById('current-preferred-eye-color');
            const currentPreferredEyeColor = currentPreferredEyeColorInput?.value?.trim() || '';
            data.eyeColors.forEach(color => {
                // Skip "Prefer not to say" option in Preferences section
                if (color.name === 'Prefer not to say') return;
                const option = document.createElement('option');
                option.value = color.name;
                option.textContent = color.name;
                if (color.name && color.name.toLowerCase() === (currentPreferredEyeColor || '').toLowerCase()) {
                    option.selected = true;
                }
                preferredEyeColorSelect.appendChild(option);
            });
        }
        
        // Preferred hair color
        const preferredHairColorSelect = document.getElementById('preferred-hair-color');
        if (preferredHairColorSelect && data.hairColors) {
            const currentPreferredHairColorInput = document.getElementById('current-preferred-hair-color');
            const currentPreferredHairColor = currentPreferredHairColorInput?.value?.trim() || '';
            data.hairColors.forEach(color => {
                // Skip "Prefer not to say" option in Preferences section
                if (color.name === 'Prefer not to say') return;
                const option = document.createElement('option');
                option.value = color.name;
                option.textContent = color.name;
                if (color.name && color.name.toLowerCase() === (currentPreferredHairColor || '').toLowerCase()) {
                    option.selected = true;
                }
                preferredHairColorSelect.appendChild(option);
            });
        }
        
        // Preferred ethnicity
        const preferredEthnicitySelect = document.getElementById('preferred-ethnicity');
        if (preferredEthnicitySelect && data.ethnicities) {
            const currentPreferredEthnicityInput = document.getElementById('current-preferred-ethnicity');
            const currentPreferredEthnicity = currentPreferredEthnicityInput?.value?.trim() || '';
            data.ethnicities.forEach(ethnicity => {
                // Skip "Prefer not to say" option in Preferences section
                if (ethnicity.name === 'Prefer not to say') return;
                const option = document.createElement('option');
                option.value = ethnicity.name;
                option.textContent = ethnicity.name;
                if (ethnicity.name && ethnicity.name.toLowerCase() === (currentPreferredEthnicity || '').toLowerCase()) {
                    option.selected = true;
                }
                preferredEthnicitySelect.appendChild(option);
            });
        }
        
        // Preferred occupation
        const preferredOccupationSelect = document.getElementById('preferred-occupation');
        if (preferredOccupationSelect && data.occupationCategories) {
            const currentPreferredOccupationInput = document.getElementById('current-preferred-occupation');
            const currentPreferredOccupation = currentPreferredOccupationInput?.value?.trim() || '';
            data.occupationCategories.forEach(category => {
                // Skip "Prefer not to say" option in Preferences section
                if (category.name === 'Prefer not to say') return;
                const option = document.createElement('option');
                option.value = category.name;
                option.textContent = category.name;
                if (category.name && category.name.toLowerCase() === (currentPreferredOccupation || '').toLowerCase()) {
                    option.selected = true;
                }
                preferredOccupationSelect.appendChild(option);
            });
        }
        
        // Preferred income
        const preferredIncomeSelect = document.getElementById('preferred-income');
        if (preferredIncomeSelect && data.incomeRanges) {
            const currentPreferredIncomeInput = document.getElementById('current-preferred-income');
            const currentPreferredIncome = currentPreferredIncomeInput?.value?.trim() || '';
            data.incomeRanges.forEach(income => {
                // Skip "Prefer not to say" option in Preferences section
                if (income.name === 'Prefer not to say') return;
                const option = document.createElement('option');
                option.value = income.name;
                option.textContent = income.name;
                if (income.name && income.name.toLowerCase() === (currentPreferredIncome || '').toLowerCase()) {
                    option.selected = true;
                }
                preferredIncomeSelect.appendChild(option);
            });
        }
        
        // Preferred marital status
        const preferredMaritalStatusSelect = document.getElementById('preferred-marital-status');
        if (preferredMaritalStatusSelect && data.maritalStatuses) {
            const currentPreferredMaritalStatusInput = document.getElementById('current-preferred-marital-status');
            const currentPreferredMaritalStatus = currentPreferredMaritalStatusInput?.value?.trim() || '';
            data.maritalStatuses.forEach(status => {
                // Skip "Prefer not to say" option in Preferences section
                if (status.name === 'Prefer not to say') return;
                const option = document.createElement('option');
                option.value = status.name;
                option.textContent = status.name;
                if (status.name && status.name.toLowerCase() === (currentPreferredMaritalStatus || '').toLowerCase()) {
                    option.selected = true;
                }
                preferredMaritalStatusSelect.appendChild(option);
            });
        }
        
        // Preferred lifestyle
        const preferredLifestyleSelect = document.getElementById('preferred-lifestyle');
        if (preferredLifestyleSelect && data.lifestylePreferences) {
            const currentPreferredLifestyleInput = document.getElementById('current-preferred-lifestyle');
            const currentPreferredLifestyle = currentPreferredLifestyleInput?.value?.trim() || '';
            data.lifestylePreferences.forEach(lifestyle => {
                // Skip "Prefer not to say" option in Preferences section
                if (lifestyle.name === 'Prefer not to say') return;
                const option = document.createElement('option');
                option.value = lifestyle.name;
                option.textContent = lifestyle.name;
                if (lifestyle.name && lifestyle.name.toLowerCase() === (currentPreferredLifestyle || '').toLowerCase()) {
                    option.selected = true;
                }
                preferredLifestyleSelect.appendChild(option);
            });
        }
        
        // Preferred body art
        const preferredBodyArtSelect = document.getElementById('preferred-body-art');
        if (preferredBodyArtSelect && data.bodyArt) {
            const currentPreferredBodyArtInput = document.getElementById('current-preferred-body-art');
            const currentPreferredBodyArt = currentPreferredBodyArtInput?.value?.trim() || '';
            data.bodyArt.forEach(art => {
                // Skip "Prefer not to say" option in Preferences section
                if (art.name === 'Prefer not to say') return;
                const option = document.createElement('option');
                option.value = art.name;
                option.textContent = art.name;
                if (art.name && art.name.toLowerCase() === (currentPreferredBodyArt || '').toLowerCase()) {
                    option.selected = true;
                }
                preferredBodyArtSelect.appendChild(option);
            });
        }
        
        // Preferred English ability
        const preferredEnglishAbilitySelect = document.getElementById('preferred-english-ability');
        if (preferredEnglishAbilitySelect && data.englishAbility) {
            const currentPreferredEnglishAbilityInput = document.getElementById('current-preferred-english-ability');
            const currentPreferredEnglishAbility = currentPreferredEnglishAbilityInput?.value?.trim() || '';
            data.englishAbility.forEach(ability => {
                // Skip "Prefer not to say" option in Preferences section
                if (ability.name === 'Prefer not to say') return;
                const option = document.createElement('option');
                option.value = ability.name;
                option.textContent = ability.name;
                if (ability.name && ability.name.toLowerCase() === (currentPreferredEnglishAbility || '').toLowerCase()) {
                    option.selected = true;
                }
                preferredEnglishAbilitySelect.appendChild(option);
            });
        }
        
        // Preferred exercise
        const preferredExerciseSelect = document.getElementById('preferred-exercise');
        if (preferredExerciseSelect && data.exerciseHabits) {
            const currentPreferredExerciseInput = document.getElementById('current-preferred-exercise');
            const currentPreferredExercise = currentPreferredExerciseInput?.value?.trim() || '';
            data.exerciseHabits.forEach(habit => {
                // Skip "Prefer not to say" option in Preferences section
                if (habit.name === 'Prefer not to say') return;
                const option = document.createElement('option');
                option.value = habit.name;
                option.textContent = habit.name;
                if (habit.name && habit.name.toLowerCase() === (currentPreferredExercise || '').toLowerCase()) {
                    option.selected = true;
                }
                preferredExerciseSelect.appendChild(option);
            });
        }

        // Sync number-of-children visibility based on selected have_children value
        toggleNumberOfChildrenVisibility();
    }
    
    // Geo data handling functions (copied from register.html)
    async function populateCountrySelects() {
        try {
            const response = await fetch('/api/countries');
            const data = await response.json();
            
            if (data.success) {
                const countrySelect = document.getElementById('country');
                countrySelect.innerHTML = '<option value="">Select Country</option>';
                
                data.countries.forEach(country => {
                    const option = new Option(country.name, country.id);
                    countrySelect.add(option);
                });
                
                // Set current values if they exist
                if ('{{countryId}}' && '{{countryId}}' !== '') {
                    countrySelect.value = '{{countryId}}';
                    onCountryChange(); // Trigger state loading
                }
            }
        } catch (error) {
            // Silently handle geo data loading errors
        }
    }
    
    async function onCountryChange() {
        const countryId = document.getElementById('country').value;
        const stateSelect = document.getElementById('state');
        const citySelect = document.getElementById('city');
        const stateContainer = document.getElementById('state-container');
        const cityContainer = document.getElementById('city-container');
        
        // Clear state and city
        stateSelect.innerHTML = '<option value="">Select State First</option>';
        citySelect.innerHTML = '<option value="">Select City First</option>';
        stateContainer.style.display = 'none';
        cityContainer.style.display = 'none';
        // Remove required validation when containers are hidden
        stateSelect.removeAttribute('required');
        citySelect.removeAttribute('required');
        document.getElementById('state-required').style.display = 'none';
        document.getElementById('city-required').style.display = 'none';
        
        if (countryId) {
            try {
                stateSelect.innerHTML = '<option value="">Loading states...</option>';
                const response = await fetch(`/api/states?country_id=${countryId}`);
                const data = await response.json();
                
                if (data.success && data.states.length > 0) {
                    stateSelect.innerHTML = '<option value="">Select State</option>';
                    data.states.forEach(state => {
                        stateSelect.add(new Option(state.name, state.id));
                    });
                    stateContainer.style.display = 'block';
                    // Add required validation when states are available
                    stateSelect.setAttribute('required', 'required');
                    stateSelect.setCustomValidity('');
                    document.getElementById('state-required').style.display = 'inline';
                    
                    // Set current state if it exists
                    if ('{{stateId}}' && '{{stateId}}' !== '') {
                        stateSelect.value = '{{stateId}}';
                        onStateChange(); // Trigger city loading
                    }
                } else {
                    stateSelect.innerHTML = '<option value="">No states available</option>';
                    // Remove required validation when no states available
                    stateSelect.removeAttribute('required');
                    document.getElementById('state-required').style.display = 'none';
                }
            } catch (error) {
                stateSelect.innerHTML = '<option value="">Error loading states</option>';
            }
        }
    }
    
    async function onStateChange() {
        const stateId = document.getElementById('state').value;
        const citySelect = document.getElementById('city');
        const cityContainer = document.getElementById('city-container');
        
        citySelect.innerHTML = '<option value="">Select City First</option>';
        cityContainer.style.display = 'none';
        // Remove required validation when container is hidden
        citySelect.removeAttribute('required');
        document.getElementById('city-required').style.display = 'none';
        
        if (stateId) {
            try {
                citySelect.innerHTML = '<option value="">Loading cities...</option>';
                const response = await fetch(`/api/cities?state_id=${stateId}`);
                const data = await response.json();
                
                if (data.success && data.cities.length > 0) {
                    citySelect.innerHTML = '<option value="">Select City</option>';
                    data.cities.forEach(city => {
                        citySelect.add(new Option(city.name, city.id));
                    });
                    cityContainer.style.display = 'block';
                    // Add required validation when cities are available
                    citySelect.setAttribute('required', 'required');
                    citySelect.setCustomValidity('');
                    document.getElementById('city-required').style.display = 'inline';
                    
                    // Set current city if it exists
                    if ('{{cityId}}' && '{{cityId}}' !== '') {
                        citySelect.value = '{{cityId}}';
                    }
                } else {
                    citySelect.innerHTML = '<option value="">No cities available</option>';
                    // Remove required validation when no cities available
                    citySelect.removeAttribute('required');
                    document.getElementById('city-required').style.display = 'none';
                }
            } catch (error) {
                citySelect.innerHTML = '<option value="">Error loading cities</option>';
            }
        }
    }
    
    // Load user languages using LanguagesModalManager
    async function loadUserLanguages() {
        if (languagesModalManager) {
            await languagesModalManager.loadUserLanguages();
        } else if (window.LanguagesModalManager) {
            languagesModalManager = window.LanguagesModalManager;
            await languagesModalManager.loadUserLanguages();
        }
    }
    
    // Load lookup data when page loads
    loadLookupData();
    
    // Load user languages after lookup data is loaded and modal is ready
    // Use Promise-based approach instead of setTimeout for better reliability
    (async function() {
        // Wait for modal to be loaded (check every 100ms, max 3 seconds)
        let attempts = 0;
        const maxAttempts = 30;
        
        while (attempts < maxAttempts) {
            if (window.LanguagesModalManager && document.getElementById('languages-modal')) {
                languagesModalManager = window.LanguagesModalManager;
                // Set languages data from lookup data
                if (languagesData && languagesData.languages) {
                    languagesModalManager.languagesData = languagesData;
                }
                await loadUserLanguages();
                break;
            }
            await new Promise(resolve => setTimeout(resolve, 100));
            attempts++;
        }
    })();
    
    // Initialize geo data
    populateCountrySelects();
    
    // Add event listeners for geo dropdowns
    document.getElementById('country').addEventListener('change', onCountryChange);
    document.getElementById('state').addEventListener('change', onStateChange);

    // Interests management functions
    function updateSelectedInterestsDisplay() {
        const container = document.getElementById('selected-interests');
        const countSpan = document.getElementById('selected-interests-count');
        
        if (!container || !countSpan) return;
        
        container.innerHTML = '';
        countSpan.textContent = selectedInterests.length;
        
        selectedInterests.forEach(interest => {
            const span = document.createElement('span');
            span.style.cssText = 'background: #e3f2fd; color: #1976d2; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem;';
            span.innerHTML = `${interest.icon || ''} ${interest.name} <span style="cursor: pointer; font-weight: bold;" onclick="removeInterest('${interest.value.replace(/'/g, "\\'")}')"></span>`;
            container.appendChild(span);
        });
    }
    
    // Add interest to selection
    function addInterest(interestValue) {
        if (!interestValue) return;
        
        const interest = allInterests.find(i => 
            String(i.id) === String(interestValue) ||
            i.value === interestValue || 
            i.name === interestValue
        );
        
        if (interest && !selectedInterests.find(si => si.id === interest.id || si.name === interest.name)) {
            if (selectedInterests.length < 10) {
                selectedInterests.push(interest);
                updateSelectedInterestsDisplay();
                const interestsSelect = document.getElementById('interests-edit');
                if (interestsSelect) {
                    interestsSelect.value = '';
                }
            } else {
                showNotification('Maximum 10 interests can be selected', 'error');
            }
        } else if (interest && selectedInterests.find(si => si.id === interest.id || si.name === interest.name)) {
            showNotification('This interest is already selected', 'info');
        }
    }
    
    // Remove interest from selection
    window.removeInterest = function(interestValue) {
        selectedInterests = selectedInterests.filter(i => i.value !== interestValue && i.name !== interestValue);
        updateSelectedInterestsDisplay();
    };
    
    // Event listener for interests dropdown
    const interestsSelect = document.getElementById('interests-edit');
    if (interestsSelect) {
        interestsSelect.addEventListener('change', function() {
            if (this.value) {
                addInterest(this.value);
            }
        });
    }

    // Hobbies management functions
    // Minimal icon helper to avoid runtime errors; returns '' (no icon)
    function faIconToEmoji(icon) {
        return '';
    }

    function updateSelectedHobbiesDisplay() {
        const container = document.getElementById('selected-hobbies');
        const countSpan = document.getElementById('selected-hobbies-count');
        
        if (!container || !countSpan) return;
        
        container.innerHTML = '';
        countSpan.textContent = selectedHobbies.length;
        
        selectedHobbies.forEach(hobby => {
            const span = document.createElement('span');
            span.style.cssText = 'background: #fff3e0; color: #e65100; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem;';
            const isFaIcon = (hobby.icon || '').startsWith('fa');
            const iconText = isFaIcon ? faIconToEmoji(hobby.icon) : (hobby.icon || '');
            const iconHtml = iconText ? `${iconText} ` : '';
            span.innerHTML = `${iconHtml}${hobby.name} <span style="cursor: pointer; font-weight: bold;" onclick="removeHobby('${hobby.value.replace(/'/g, "\\'")}')"></span>`;
            container.appendChild(span);
        });
    }
    
    function addHobby(hobbyValue) {
        if (!hobbyValue) return;
        
        const hobby = allHobbies.find(h => 
            String(h.id) === String(hobbyValue) ||
            h.value === hobbyValue || 
            h.name === hobbyValue
        );
        
        if (hobby && !selectedHobbies.find(sh => sh.id === hobby.id || sh.name === hobby.name)) {
            if (selectedHobbies.length < 10) {
                selectedHobbies.push(hobby);
                updateSelectedHobbiesDisplay();
                const hobbiesSelect = document.getElementById('hobbies-select');
                if (hobbiesSelect) {
                    hobbiesSelect.value = '';
                }
            } else {
                showNotification('Maximum 10 hobbies can be selected', 'error');
            }
        } else if (hobby && selectedHobbies.find(sh => sh.id === hobby.id || sh.name === hobby.name)) {
            showNotification('This hobby is already selected', 'info');
        }
    }
    
    window.removeHobby = function(hobbyValue) {
        selectedHobbies = selectedHobbies.filter(h => h.value !== hobbyValue && h.name !== hobbyValue);
        updateSelectedHobbiesDisplay();
    };
    
    const hobbiesSelect = document.getElementById('hobbies-select');
    if (hobbiesSelect) {
        hobbiesSelect.addEventListener('change', function() {
            if (this.value) {
                addHobby(this.value);
            }
        });
    }
    
    // Show/hide number of children based on have_children selection
    const haveChildrenSelectEl = document.getElementById('have-children');
    if (haveChildrenSelectEl) {
        haveChildrenSelectEl.addEventListener('change', toggleNumberOfChildrenVisibility);
    }
    
    // Add event listener for preferred children select
    const preferredChildrenSelectEl = document.getElementById('preferred-children');
    if (preferredChildrenSelectEl) {
        preferredChildrenSelectEl.addEventListener('change', togglePreferredNumberOfChildrenVisibility);
    }
    
    // Add custom validation messages for state and city
    const stateSelect = document.getElementById('state');
    const citySelect = document.getElementById('city');
    
    stateSelect.addEventListener('invalid', function(e) {
        if (stateSelect.validity.valueMissing) {
            stateSelect.setCustomValidity('Please select a state');
        }
    });
    
    stateSelect.addEventListener('change', function(e) {
        stateSelect.setCustomValidity('');
    });
    
    citySelect.addEventListener('invalid', function(e) {
        if (citySelect.validity.valueMissing) {
            citySelect.setCustomValidity('Please select a city');
        }
    });
    
    citySelect.addEventListener('change', function(e) {
        citySelect.setCustomValidity('');
    });
    
    // Handle About Me form submission
    aboutMeForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Check HTML5 form validation
        if (!aboutMeForm.checkValidity()) {
            // Trigger browser's native validation messages
            aboutMeForm.reportValidity();
            return;
        }
        
        // Show loading state
        saveAboutMeBtn.disabled = true;
        saveAboutMeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        
        try {
            // Get form data
            const formData = new FormData(aboutMeForm);
            const data = Object.fromEntries(formData.entries());
            
            // Prepare request payload (session manager handles authentication)
            // Remove sessionToken from payload as it's sent in Authorization header
            const { sessionToken, ...payload } = data;
            
            // Handle multiple interests - send IDs array and keep legacy single field
            if (selectedInterests && selectedInterests.length > 0) {
                const ids = selectedInterests
                    .map(i => (i.id != null ? i.id : i.value || i.name))
                    .filter(Boolean);
                payload.interest_categories = ids;

                const primaryInterest = selectedInterests[0];
                const primaryId = primaryInterest?.id != null ? primaryInterest.id : null;
                payload.interest_category = primaryId || primaryInterest?.name || primaryInterest?.value || null;
            } else {
                payload.interest_category = null;
                payload.interest_categories = [];
            }

            // Handle hobbies (multi-select) -> user_hobbies_multiple
            if (selectedHobbies && selectedHobbies.length > 0) {
                const hobbyIds = selectedHobbies
                    .map(h => (h.id != null ? h.id : h.value || h.name))
                    .filter(Boolean);
                payload.hobbies = hobbyIds;
            } else {
                payload.hobbies = [];
            }
            
            // Explicitly clear state and city if their containers are hidden (country has no states/cities)
            const stateContainer = document.getElementById('state-container');
            const cityContainer = document.getElementById('city-container');
            if (stateContainer && stateContainer.style.display === 'none') {
                payload.state = null; // Explicitly set to null to clear state_id in database
            }
            if (cityContainer && cityContainer.style.display === 'none') {
                payload.city = null; // Explicitly set to null to clear city_id in database
            }
            
            // Clear number_of_children when hidden
            const numberChildrenContainer = document.getElementById('number-of-children-container');
            const numberChildrenSelect = document.getElementById('number-of-children');
            if (numberChildrenContainer && numberChildrenContainer.style.display === 'none') {
                payload.number_of_children = null;
            }
            
            // Ensure userId is included from hidden input
            if (!payload.userId) {
                const userIdInput = document.querySelector('#about-me-form input[name="userId"]');
                if (userIdInput) {
                    payload.userId = userIdInput.value;
                }
            }
            
            // Send update request using session manager
            const response = await window.sessionManager.apiRequest('/api/profile/update', {
                method: 'POST',
                body: JSON.stringify(payload)
            });
            
            // Robust error handling: read body when server returns non-2xx
            if (!response.ok) {
                const text = await response.text().catch(() => null);
                throw new Error(text || `Server returned ${response.status}`);
            }
            
            const result = await response.json();
            
            if (result.success) {
                // Show success message
                showNotification('About Me updated successfully!', 'success');
            } else {
                throw new Error(result.error || 'Failed to update profile');
            }
            
        } catch (error) {
            showNotification(error.message || 'Failed to update About Me. Please try again.', 'error');
        } finally {
            // Reset button state
            saveAboutMeBtn.disabled = false;
            saveAboutMeBtn.innerHTML = '<i class="fas fa-save"></i> Save About Me';
        }
    });

    // Handle Preferences form submission
    preferencesForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Show loading state
        savePreferencesBtn.disabled = true;
        savePreferencesBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        
        try {
            // Get form data
            const formData = new FormData(preferencesForm);
            const data = Object.fromEntries(formData.entries());
            
            // Prepare request payload (session manager handles authentication)
            // Remove sessionToken from payload as it's sent in Authorization header
            const { sessionToken, ...payload } = data;
            
            // Handle preferred_number_of_children field
            const preferredChildrenSelect = document.getElementById('preferred-children');
            const preferredNumberChildrenSelect = document.getElementById('preferred-number-of-children');
            const preferredNumberChildrenContainer = document.getElementById('preferred-number-of-children-container');
            
            if (preferredChildrenSelect && preferredChildrenSelect.value === 'Has children') {
                // If "Has children" is selected, ensure the number field value is included
                if (preferredNumberChildrenSelect && preferredNumberChildrenSelect.value) {
                    payload.preferred_number_of_children = preferredNumberChildrenSelect.value;
                }
            } else {
                // If "Has children" is not selected, clear the number field
                payload.preferred_number_of_children = null;
            }
            
            // Ensure userId is included from hidden input
            if (!payload.userId) {
                const userIdInput = document.querySelector('#preferences-form input[name="userId"]');
                if (userIdInput) {
                    payload.userId = userIdInput.value;
                }
            }
            
            // Send update request using session manager
            const response = await window.sessionManager.apiRequest('/api/profile/update', {
                method: 'POST',
                body: JSON.stringify(payload)
            });
            
            // Robust error handling: read body when server returns non-2xx
            if (!response.ok) {
                const text = await response.text().catch(() => null);
                throw new Error(text || `Server returned ${response.status}`);
            }
            
            const result = await response.json();
            
            if (result.success) {
                // Show success message
                showNotification('Preferences updated successfully!', 'success');
            } else {
                throw new Error(result.error || 'Failed to update preferences');
            }
            
        } catch (error) {
            showNotification(error.message || 'Failed to update preferences. Please try again.', 'error');
        } finally {
            // Reset button state
            savePreferencesBtn.disabled = false;
            savePreferencesBtn.innerHTML = '<i class="fas fa-save"></i> Save Preferences';
        }
    });
    
    // Handle cancel button
    cancelBtn.addEventListener('click', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const sessionToken = urlParams.get('token');
        window.location.href = `/profile-full?token=${sessionToken}`;
    });
    
    // Notification function
    function showNotification(message, type = 'info') {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.innerHTML = `
            <div class="notification-content">
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            </div>
        `;
        
        // Add to page
        document.body.appendChild(notification);
        
        // Show notification
        setTimeout(() => notification.classList.add('show'), 100);
        
        // Remove after 5 seconds
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => notification.remove(), 300);
        }, 5000);
    }
    
    // Auto-save draft functionality for both forms
    let autoSaveTimeout;
    const aboutMeInputs = aboutMeForm.querySelectorAll('input, select, textarea');
    const preferencesInputs = preferencesForm.querySelectorAll('input, select, textarea');
    const allFormInputs = [...aboutMeInputs, ...preferencesInputs];
    
    allFormInputs.forEach(input => {
        input.addEventListener('input', function() {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(() => {
                saveDraft();
            }, 2000); // Auto-save after 2 seconds of inactivity
        });
    });
    
    function saveDraft() {
        // Show subtle notification
        const notification = document.createElement('div');
        notification.className = 'draft-saved';
        notification.textContent = 'Draft saved';
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        `;
        
        document.body.appendChild(notification);
        setTimeout(() => notification.style.opacity = '1', 100);
        setTimeout(() => {
            notification.style.opacity = '0';
            setTimeout(() => notification.remove(), 300);
        }, 2000);
    }
});
</script>

<style>
.edit-form-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 1rem;
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 2rem !important;
    width: 100% !important;
    box-sizing: border-box !important;
}

.edit-form-container > .profile-section {
    width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box !important;
    display: flex !important;
    flex-direction: column !important;
}

.edit-title {
    text-align: center;
    color: #333;
    margin-bottom: 2rem;
    font-size: 2rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
}

.edit-title i {
    color: #667eea;
}

.edit-cards-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    margin-bottom: 2rem;
}

.edit-card {
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.card-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1.5rem;
    border-bottom: 2px solid #e1e5e9;
    display: flex;
    justify-content: center;
    align-items: center;
}

.card-title {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
}

.card-title i {
    font-size: 1rem;
}

.card-content {
    padding: 2rem;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #555;
    font-size: 0.95rem;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    font-size: 0.95rem;
    transition: border-color 0.3s ease;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.form-group textarea {
    resize: vertical;
    min-height: 100px;
}



.form-actions {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 2px solid #f0f0f0;
}

.form-actions-bottom {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 2rem;
    padding-top: 2rem;
}

.save-btn,
.cancel-btn {
    padding: 1rem 2rem;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.save-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.save-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.cancel-btn {
    background: #f8f9fa;
    color: #6c757d;
    border: 2px solid #e9ecef;
}

.cancel-btn:hover {
    background: #e9ecef;
    color: #495057;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .edit-cards-container {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
}

@media (max-width: 768px) {
    .edit-form-container {
        padding: 0.5rem;
    }
    
    .edit-cards-container {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
    
    .card-content {
        padding: 1.5rem;
    }
    
    .form-row {
        grid-template-columns: 1fr;
        gap: 0;
    }
    
    .form-actions {
        flex-direction: column;
        align-items: center;
    }
    
    .save-btn,
    .cancel-btn {
        width: 100%;
        max-width: 300px;
    }
}

@media (max-width: 480px) {
    .edit-title {
        font-size: 1.5rem;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .card-header {
        padding: 1rem;
    }
    
    .card-title {
        font-size: 1.1rem;
    }
    
    .card-content {
        padding: 1rem;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
        padding: 0.5rem;
        font-size: 0.9rem;
    }
}

/* Notification Styles */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    padding: 1rem 1.5rem;
    z-index: 1000;
    transform: translateX(100%);
    transition: transform 0.3s ease;
    max-width: 400px;
}

.notification.show {
    transform: translateX(0);
}

.notification-content {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.notification i {
    font-size: 1.25rem;
}

.notification-success {
    border-left: 4px solid #28a745;
}

.notification-success i {
    color: #28a745;
}

.notification-error {
    border-left: 4px solid #dc3545;
}

.notification-error i {
    color: #dc3545;
}

.notification-info {
    border-left: 4px solid #17a2b8;
}

.notification-info i {
    color: #17a2b8;
}

/* Button States */
.save-btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}

.save-btn:disabled:hover {
    transform: none;
    box-shadow: none;
}

/* Draft Saved Indicator */
.draft-saved {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #28a745;
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 12px;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 1000;
}

/* Form Validation Styles */
.form-group input:invalid,
.form-group select:invalid,
.form-group textarea:invalid {
    border-color: #dc3545;
}

.form-group input:invalid:focus,
.form-group select:invalid:focus,
.form-group textarea:invalid:focus {
    box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
}

/* Loading Animation */
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.fa-spin {
    animation: spin 1s linear infinite;
}

/* Languages Management Button */
.manage-languages-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 0.75rem 1.5rem;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    width: auto;
}

.manage-languages-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.current-languages-display {
    margin-top: 0.5rem;
    padding: 0.5rem;
    background: #f8f9fa;
    border-radius: 6px;
    min-height: 1.5rem;
}

.languages-badges-container {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.language-badge {
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: white;
    color: #333;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    user-select: none;
    border: 1px solid #e1e5e9;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.language-badge:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    border-color: #667eea;
}

.language-content {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.language-flag-icon {
    flex-shrink: 0;
    border-radius: 3px;
}

.language-badge:active {
    transform: translateY(0);
}

.language-name {
    display: inline-block;
}

.language-flag-icon {
    width: 24px;
    height: 18px;
    display: inline-block;
    border-radius: 3px;
    flex-shrink: 0;
}

/* CSS flag icons as fallback */
.flag-icon {
    display: inline-block;
    width: 24px;
    height: 18px;
    border-radius: 3px;
    vertical-align: middle;
}

.flag-us {
    background: linear-gradient(to bottom, #B22234 0%, #B22234 7.7%, #FFFFFF 7.7%, #FFFFFF 15.4%, #B22234 15.4%);
}

.flag-es {
    background: linear-gradient(to bottom, #C60B1E 25%, #FFC400 25%, #FFC400 75%, #C60B1E 75%);
}

.flag-fr {
    background: linear-gradient(to right, #002395 33.33%, #FFFFFF 33.33%, #FFFFFF 66.66%, #ED2939 66.66%);
}

.flag-de {
    background: linear-gradient(to bottom, #000000 33.33%, #DD0000 33.33%, #DD0000 66.66%, #FFCE00 66.66%);
}

.flag-it {
    background: linear-gradient(to right, #009246 33.33%, #FFFFFF 33.33%, #FFFFFF 66.66%, #CE2B37 66.66%);
}

.flag-pt {
    background: linear-gradient(to bottom, #006600 0%, #006600 50%, #FF0000 50%, #FF0000 100%);
}

.flag-ru {
    background: linear-gradient(to bottom, #FFFFFF 33.33%, #0039A6 33.33%, #0039A6 66.66%, #D52B1E 66.66%);
}

.flag-cn, .flag-zh {
    background: #DE2910;
    position: relative;
}

.flag-cn:before, .flag-zh:before {
    content: '';
    color: #FFDE00;
    position: absolute;
    left: 2px;
    top: -1px;
    font-size: 12px;
}

.flag-ja {
    background: #FFFFFF;
    background-image: radial-gradient(circle, #BC002D 30%, transparent 30%);
    background-size: 50% 50%;
    background-position: center;
}

.flag-ko {
    background: linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 50%, #000000 50%, #000000 100%);
    background-image: 
        radial-gradient(circle at 50% 50%, #CE1126 20%, transparent 20%),
        linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 50%, #000000 50%, #000000 100%);
}

.flag-ar {
    background: linear-gradient(to bottom, #000000 0%, #000000 33.33%, #FFFFFF 33.33%, #FFFFFF 66.66%, #006C35 66.66%);
}

.flag-hi {
    background: linear-gradient(to bottom, #FF9933 0%, #FF9933 33.33%, #FFFFFF 33.33%, #FFFFFF 66.66%, #138808 66.66%);
    background-image: 
        radial-gradient(circle at 50% 50%, #000080 15%, transparent 15%),
        linear-gradient(to bottom, #FF9933 0%, #FF9933 33.33%, #FFFFFF 33.33%, #FFFFFF 66.66%, #138808 66.66%);
}

.flag-vn {
    background: linear-gradient(to bottom, #DA020E 50%, #FFFF00 50%);
    position: relative;
}

.flag-vn:before {
    content: '';
    color: #FFFF00;
    position: absolute;
    left: 8px;
    top: 1px;
    font-size: 10px;
}

.flag-th {
    background: linear-gradient(to bottom, #ED1C24 16.66%, #FFFFFF 16.66%, #FFFFFF 33.33%, #241D4F 33.33%, #241D4F 66.66%, #FFFFFF 66.66%, #FFFFFF 83.33%, #ED1C24 83.33%);
}

.flag-tr {
    background: linear-gradient(to bottom, #E30A17 0%, #E30A17 50%, #FFFFFF 50%);
    background-image: 
        radial-gradient(circle at 25% 50%, #FFFFFF 12%, transparent 12%),
        linear-gradient(to bottom, #E30A17 0%, #E30A17 50%, #FFFFFF 50%);
}

.flag-pl {
    background: linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 50%, #DC143C 50%);
}

.flag-nl {
    background: linear-gradient(to bottom, #AE1C28 0%, #AE1C28 33.33%, #FFFFFF 33.33%, #FFFFFF 66.66%, #21468B 66.66%);
}

.flag-sv {
    background: linear-gradient(to bottom, #006AA7 0%, #006AA7 50%, #FECC00 50%);
    background-image: 
        linear-gradient(to right, #006AA7 0%, #006AA7 50%, #FECC00 50%),
        linear-gradient(to bottom, #006AA7 0%, #006AA7 50%, #FECC00 50%);
    background-size: 30% 30%;
    background-position: left top;
}

.flag-no {
    background: linear-gradient(to bottom, #BA0C2F 0%, #BA0C2F 50%, #FFFFFF 50%);
    background-image: 
        linear-gradient(to right, #BA0C2F 0%, #BA0C2F 50%, #FFFFFF 50%),
        linear-gradient(to bottom, #BA0C2F 0%, #BA0C2F 50%, #FFFFFF 50%);
    background-size: 30% 30%;
    background-position: left top;
}

.flag-da {
    background: linear-gradient(to bottom, #C8102E 0%, #C8102E 50%, #FFFFFF 50%);
    background-image: 
        linear-gradient(to right, #C8102E 0%, #C8102E 50%, #FFFFFF 50%),
        linear-gradient(to bottom, #C8102E 0%, #C8102E 50%, #FFFFFF 50%);
    background-size: 30% 30%;
    background-position: left top;
}

.flag-fi {
    background: linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 50%, #003580 50%);
    background-image: 
        linear-gradient(to right, #FFFFFF 0%, #FFFFFF 50%, #003580 50%),
        linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 50%, #003580 50%);
    background-size: 30% 30%;
    background-position: left top;
}

.flag-el {
    background: linear-gradient(to bottom, #0D5EAF 0%, #0D5EAF 25%, #FFFFFF 25%, #FFFFFF 50%, #0D5EAF 50%, #0D5EAF 75%, #FFFFFF 75%);
}

.flag-he {
    background: linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 50%, #0038B8 50%);
}

.flag-cs {
    background: linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 50%, #D7141A 50%);
}

.flag-hu {
    background: linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 33.33%, #CE2939 33.33%, #CE2939 66.66%, #477050 66.66%);
}

.flag-ro {
    background: linear-gradient(to right, #002B7F 0%, #002B7F 33.33%, #FCD116 33.33%, #FCD116 66.66%, #CE1126 66.66%);
}

.flag-bg {
    background: linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 33.33%, #00966E 33.33%, #00966E 66.66%, #D62612 66.66%);
}

.flag-hr {
    background: linear-gradient(to bottom, #171796 0%, #171796 33.33%, #FFFFFF 33.33%, #FFFFFF 66.66%, #FF0000 66.66%);
}

.flag-sk {
    background: linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 33.33%, #0B4EA2 33.33%, #0B4EA2 66.66%, #EE1C25 66.66%);
}

.flag-sl {
    background: linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 33.33%, #0C47B7 33.33%, #0C47B7 66.66%, #FF0000 66.66%);
}

.flag-uk {
    background: linear-gradient(to bottom, #0057B7 0%, #0057B7 50%, #FFD700 50%);
}

/* Flag backgrounds using CSS gradients and images */
.flag-badge-en {
    background: linear-gradient(135deg, #B22234 0%, #B22234 7.7%, #FFFFFF 7.7%, #FFFFFF 15.4%, #B22234 15.4%, #B22234 50%, #FFFFFF 50%, #FFFFFF 57.7%, #B22234 57.7%, #B22234 65.4%, #FFFFFF 65.4%, #FFFFFF 73.1%, #B22234 73.1%, #B22234 80.8%, #FFFFFF 80.8%, #FFFFFF 88.5%, #B22234 88.5%, #B22234 100%);
    background-size: 30% 100%;
    background-position: left top;
}

.flag-badge-es {
    background: linear-gradient(to bottom, #C60B1E 0%, #C60B1E 25%, #FFC400 25%, #FFC400 75%, #C60B1E 75%);
}

.flag-badge-fr {
    background: linear-gradient(to right, #002395 0%, #002395 33.33%, #FFFFFF 33.33%, #FFFFFF 66.66%, #ED2939 66.66%);
}

.flag-badge-de {
    background: linear-gradient(to bottom, #000000 0%, #000000 33.33%, #DD0000 33.33%, #DD0000 66.66%, #FFCE00 66.66%);
}

.flag-badge-it {
    background: linear-gradient(to right, #009246 0%, #009246 33.33%, #FFFFFF 33.33%, #FFFFFF 66.66%, #CE2B37 66.66%);
}

.flag-badge-pt {
    background: linear-gradient(to bottom, #006600 0%, #006600 50%, #FF0000 50%, #FF0000 100%);
}

.flag-badge-ru {
    background: linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 33.33%, #0039A6 33.33%, #0039A6 66.66%, #D52B1E 66.66%);
}

.flag-badge-zh {
    background: #DE2910;
}

.flag-badge-ja {
    background: #FFFFFF;
    background-image: radial-gradient(circle, #BC002D 30%, transparent 30%);
    background-size: 50% 50%;
    background-position: center;
}

.flag-badge-ko {
    background: linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 50%, #000000 50%, #000000 100%);
    background-image: 
        radial-gradient(circle at 50% 50%, #CE1126 20%, transparent 20%),
        linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 50%, #000000 50%, #000000 100%);
}

.flag-badge-ar {
    background: linear-gradient(to bottom, #000000 0%, #000000 33.33%, #FFFFFF 33.33%, #FFFFFF 66.66%, #006C35 66.66%);
}

.flag-badge-hi {
    background: linear-gradient(to bottom, #FF9933 0%, #FF9933 33.33%, #FFFFFF 33.33%, #FFFFFF 66.66%, #138808 66.66%);
    background-image: 
        radial-gradient(circle at 50% 50%, #000080 15%, transparent 15%),
        linear-gradient(to bottom, #FF9933 0%, #FF9933 33.33%, #FFFFFF 33.33%, #FFFFFF 66.66%, #138808 66.66%);
}

.flag-badge-vi {
    background: linear-gradient(to bottom, #DA020E 0%, #DA020E 50%, #FFFF00 50%);
    background-image: 
        radial-gradient(circle at 50% 25%, #FFFF00 8%, transparent 8%),
        linear-gradient(to bottom, #DA020E 0%, #DA020E 50%, #FFFF00 50%);
}

.flag-badge-th {
    background: linear-gradient(to bottom, #ED1C24 0%, #ED1C24 16.66%, #FFFFFF 16.66%, #FFFFFF 33.33%, #241D4F 33.33%, #241D4F 66.66%, #FFFFFF 66.66%, #FFFFFF 83.33%, #ED1C24 83.33%);
}

.flag-badge-tr {
    background: linear-gradient(to bottom, #E30A17 0%, #E30A17 50%, #FFFFFF 50%);
    background-image: 
        radial-gradient(circle at 25% 50%, #FFFFFF 12%, transparent 12%),
        linear-gradient(to bottom, #E30A17 0%, #E30A17 50%, #FFFFFF 50%);
}

.flag-badge-pl {
    background: linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 50%, #DC143C 50%);
}

.flag-badge-nl {
    background: linear-gradient(to bottom, #AE1C28 0%, #AE1C28 33.33%, #FFFFFF 33.33%, #FFFFFF 66.66%, #21468B 66.66%);
}

.flag-badge-sv {
    background: linear-gradient(to bottom, #006AA7 0%, #006AA7 50%, #FECC00 50%);
    background-image: 
        linear-gradient(to right, #006AA7 0%, #006AA7 50%, #FECC00 50%),
        linear-gradient(to bottom, #006AA7 0%, #006AA7 50%, #FECC00 50%);
    background-size: 30% 30%;
    background-position: left top;
}

.flag-badge-no {
    background: linear-gradient(to bottom, #BA0C2F 0%, #BA0C2F 50%, #FFFFFF 50%);
    background-image: 
        linear-gradient(to right, #BA0C2F 0%, #BA0C2F 50%, #FFFFFF 50%),
        linear-gradient(to bottom, #BA0C2F 0%, #BA0C2F 50%, #FFFFFF 50%);
    background-size: 30% 30%;
    background-position: left top;
}

.flag-badge-da {
    background: linear-gradient(to bottom, #C8102E 0%, #C8102E 50%, #FFFFFF 50%);
    background-image: 
        linear-gradient(to right, #C8102E 0%, #C8102E 50%, #FFFFFF 50%),
        linear-gradient(to bottom, #C8102E 0%, #C8102E 50%, #FFFFFF 50%);
    background-size: 30% 30%;
    background-position: left top;
}

.flag-badge-fi {
    background: linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 50%, #003580 50%);
    background-image: 
        linear-gradient(to right, #FFFFFF 0%, #FFFFFF 50%, #003580 50%),
        linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 50%, #003580 50%);
    background-size: 30% 30%;
    background-position: left top;
}

.flag-badge-el {
    background: linear-gradient(to bottom, #0D5EAF 0%, #0D5EAF 25%, #FFFFFF 25%, #FFFFFF 50%, #0D5EAF 50%, #0D5EAF 75%, #FFFFFF 75%);
}

.flag-badge-he {
    background: linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 50%, #0038B8 50%);
}

.flag-badge-cs {
    background: linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 50%, #D7141A 50%);
}

.flag-badge-hu {
    background: linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 33.33%, #CE2939 33.33%, #CE2939 66.66%, #477050 66.66%);
}

.flag-badge-ro {
    background: linear-gradient(to right, #002B7F 0%, #002B7F 33.33%, #FCD116 33.33%, #FCD116 66.66%, #CE1126 66.66%);
}

.flag-badge-bg {
    background: linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 33.33%, #00966E 33.33%, #00966E 66.66%, #D62612 66.66%);
}

.flag-badge-hr {
    background: linear-gradient(to bottom, #171796 0%, #171796 33.33%, #FFFFFF 33.33%, #FFFFFF 66.66%, #FF0000 66.66%);
}

.flag-badge-sk {
    background: linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 33.33%, #0B4EA2 33.33%, #0B4EA2 66.66%, #EE1C25 66.66%);
}

.flag-badge-sl {
    background: linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 33.33%, #0C47B7 33.33%, #0C47B7 66.66%, #FF0000 66.66%);
}

.flag-badge-uk {
    background: linear-gradient(to bottom, #0057B7 0%, #0057B7 50%, #FFD700 50%);
}

/* Fallback for languages without specific flag styles */
.flag-icon:not([class*="flag-"]) {
    background: #e1e5e9;
}

.no-languages-text {
    color: #999;
    font-style: italic;
    font-size: 0.9rem;
}

.primary-badge {
    background: #667eea;
    color: white;
    padding: 0.15rem 0.4rem;
    border-radius: 10px;
    font-size: 0.7rem;
    font-weight: 600;
    margin-left: 0.5rem;
}

</style>
